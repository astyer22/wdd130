dojo.require("wc.widget.Tooltip"),require(["dojo/html","dojo/_base/lang","dojo/on","dojo/query","dojo/topic","dojo/dom","dojo/dom-style","dojo/dom-class","dojo/_base/event","dojo/_base/array","dojo/json","dojox/timing","dojo/domReady!"],function(e,r,o,t,s,a,n,i,d,l,c,u){OnBehalfUtilities=function(){this.startCustomerService=function(e){var o=e.getAttribute("data-customer-service-url"),t=getCookie("WC_BuyOnBehalf_"+WCParamJS.storeId);if("true"==CSRWCParamJS.env_shopOnBehalfSessionEstablished&&"true"==CSRWCParamJS.env_shopOnBehalfEnabled_CSR){var a=s.subscribe("onBehalfSessionTerminate",function(e){a.remove(),"YES"==e.action&&(document.location.href=o),e.action});MessageHelper.showConfirmationDialog("onBehalfSessionTerminate",r.replace(storeNLS.CSR_SESSION_TERMINATE_WARNING_MESSAGE,[escapeXml(t,!0)])),byId("confirmationPopup").style.zIndex="1001"}else document.location.href=o},this.showCSRWarningPopup=function(){if("true"==CSRWCParamJS.env_shopOnBehalfEnabled_CSR){byId("confirmationPopupNO").innerHTML=storeNLS.CSR_SESSION_TIMEOUT_WARNING_MESSAGE_CONTINUE,byId("confirmationPopupOK_Label").innerHTML=storeNLS.CSR_SESSION_TIMEOUT_WARNING_MESSAGE_SIGNOUT;var e=s.subscribe("onBehalfSessionTimeout",function(r){if(e.remove(),"YES"==r.action){if(csrLogoutTimer.stop(),"true"==CSRWCParamJS.env_shopOnBehalfSessionEstablished)if("true"==byId("env_currentOrderLocked").value){if(byId("currentOrderId"))var o=byId("currentOrderId").value;else if(document.getElementsByClassName("currentOrderId")[0])o=document.getElementsByClassName("currentOrderId")[0].value;else o=getCookie("WC_CartOrderId_"+WCParamJS.storeId);(t=[]).storeId=WCParamJS.storeId,t.catalogId=WCParamJS.catalogId,t.langId=WCParamJS.langId,t.orderId=o,t.taskType="R",t.promoCode="EMPLOYEE,EMPLOYEE7,EMPLOYEE15,EMPLOYEE7R",wc.service.invoke("AjaxPromotionCodeDelete_CSR",t)}else clearCookieOnLogout(["WC_USER_PAGE_SIZE","WC_BPS_SHIPMODE","WC_Total_Points","WC_USERDETAILS"]),clearWCCartCookieOnLogout(),GlobalLoginShopOnBehalfJS.clearUserSetInSessionAndLogoff(byId("Logon_LogoutURLOriginal_Reg_href").value);else{if(byId("currentOrderId"))o=byId("currentOrderId").value;else if(document.getElementsByClassName("currentOrderId")[0])o=document.getElementsByClassName("currentOrderId")[0].value;else o=getCookie("WC_CartOrderId_"+WCParamJS.storeId);var t;(t=[]).storeId=WCParamJS.storeId,t.catalogId=WCParamJS.catalogId,t.langId=WCParamJS.langId,t.orderId=o,t.taskType="R",t.promoCode="EMPLOYEE,EMPLOYEE7,EMPLOYEE15,EMPLOYEE7R",wc.service.invoke("AjaxPromotionCodeDelete_FROM_CSR_ACCOUNT",t)}byId("confirmationPopupOK_Label").innerHTML="Yes",byId("confirmationPopupNO").innerHTML="No"}"NO"==r.action&&(csrLogoutTimer.stop(),cursor_clear("true"),byId("confirmationPopupOK_Label").innerHTML="Yes",byId("confirmationPopupNO").innerHTML="No",csrTimerJS.resetCSRTimers())});cursor_wait("","true"),MessageHelper.showConfirmationDialog("onBehalfSessionTimeout",r.replace(storeNLS.CSR_SESSION_TIMEOUT_WARNING_MESSAGE,[escapeXml(CSRWCParamJS.csrAutoLogoutSec,!0)]),storeNLS.CSR_SESSION_TIMEOUT_WARNING_HEADER)}},this.updateUIAndRenderContext=function(e,r){var o,s,a,n=null,i=wc.render.getContextById("UserRegistrationAdminUpdateStatusContext");void 0!==i&&(o=i.properties.userId,n=i.properties[o+"_userStatus"]);var d=wc.render.getContextById("UserRegistrationAdminUpdateStatusContextCSR");void 0!==d&&(s=d.properties.userId,a=d.properties[s+"_userStatus"]);var l=null,c=null;"UserRegistrationAdminUpdateStatusContext"==r?(l=n,c=o):"UserRegistrationAdminUpdateStatusContextCSR"==r&&(l=a,c=s),void 0!==i&&(i.properties[c+"_updatedStatus"]=l),void 0!==d&&(d.properties[c+"_updatedStatus"]=l);var u=storeNLS.DISABLE_CUSTOMER_ACCOUNT;"0"==l&&(u=storeNLS.ENABLE_CUSTOMER_ACCOUNT),t("div[data-toggle-userStatus = 'userStatus_"+c+"']").forEach(function(e,r,o){e.innerHTML=u})},this.cancelOrder=function(e,r,o){wc.render.getContextById("onBehalfCommonContext").properties.cancelReloadURL=r;var t=wc.service.getServiceById("AjaxCancelOrderAdministrator");t.url=null!=o&&"true"==o?getAbsoluteURL()+"AjaxRESTCSROrderCancelOnbehalf":getAbsoluteURL()+"AjaxRESTCSROrderCancelAsAdmin";var s=[];s.orderId=e,s.storeId=WCParamJS.storeId,s.catalogId=WCParamJS.catalogId,s.langId=WCParamJS.langId,s.forcedCancel="true",wc.service.invoke("AjaxCancelOrderAdministrator",s)},this.unLockOrder=function(e,r,o){if(null==r||""==r||"true"!=r){var t=this.getLockUnLockCartService("AjaxRESTOrderLockUnlockOnBehalf",getAbsoluteURL()+"AjaxRESTOrderUnlockOnBehalf","SUCCESS_ORDER_UNLOCK"),a=[];a.orderId=e,a.filterOption="All",a.storeId=WCParamJS.storeId,a.catalogId=WCParamJS.catalogId,a.langId=WCParamJS.langId,o&&(t.isViaTimeout=o),submitRequest()&&(cursor_wait(),wc.service.invoke(t.id,a))}else{this.takeOverLock(e,"true");var n=s.subscribe("orderTakeOverSuccess",function(r){n.remove(),onBehalfUtilitiesJS.unLockOrder(e,"false")})}},this.lockOrder=function(e){var r=this.getLockUnLockCartService("AjaxRESTOrderLockUnlockOnBehalf",getAbsoluteURL()+"AjaxRESTOrderLockOnBehalf","SUCCESS_ORDER_LOCK"),o=[];o.orderId=e,o.filterOption="All",o.storeId=WCParamJS.storeId,o.catalogId=WCParamJS.catalogId,o.langId=WCParamJS.langId,submitRequest()&&(cursor_wait(),wc.service.invoke(r.id,o))},this.takeOverLock=function(e,r){var o=this.getLockUnLockCartService("AjaxRESTOrderLockUnlockOnBehalf",getAbsoluteURL()+"AjaxRESTOrderLockTakeOverOnBehalf","SUCCESS_ORDER_TAKE_OVER",r),t=[];t.orderId=e,t.filterOption="All",t.takeOverLock="Y",t.storeId=WCParamJS.storeId,t.catalogId=WCParamJS.catalogId,t.langId=WCParamJS.langId,submitRequest()&&(cursor_wait(),wc.service.invoke(o.id,t))},this.getLockUnLockCartService=function(e,r,o,t){var a=wc.service.getServiceById("AjaxRESTOrderLockUnlockOnBehalf");return null!=a&&void 0!=a||(wc.service.declare({id:"AjaxRESTOrderLockUnlockOnBehalf",actionId:"AjaxRESTOrderLockUnlockOnBehalf",url:"",formId:"",successMessageKey:"",publishTopic:"",isViaTimeout:"",successHandler:function(e){cursor_clear(),"true"!=a.publishTopic?(MessageHelper.hideAndClearMessage(),MessageHelper.displayStatusMessage(storeNLS[a.successMessageKey]),setDeleteCartCookie(),null!=dijit.byId("quick_cart_container")&&dijit.byId("quick_cart_container").hide(),"SUCCESS_ORDER_UNLOCK"==a.successMessageKey?(byId("env_currentOrderLocked").value="false",a.isViaTimeout&&"true"==a.isViaTimeout&&GlobalLoginShopOnBehalfJS.clearUserSetInSessionAndLogoff(byId("Logon_LogoutURLOriginal_Reg_href").value)):"SUCCESS_ORDER_LOCK"==a.successMessageKey&&(byId("env_currentOrderLocked").value="true")):s.publish("orderTakeOverSuccess",e)},failureHandler:function(e){e.errorMessage?MessageHelper.displayErrorMessage(e.errorMessage):e.errorMessageKey&&MessageHelper.displayErrorMessage(e.errorMessageKey)}}),a=wc.service.getServiceById("AjaxRESTOrderLockUnlockOnBehalf")),null!=e&&"undefined"!=e&&(a.actionId=e),null!=o&&"undefined"!=o&&(a.successMessageKey=o),a.publishTopic=null!=t&&"undefined"!=t?t:null,a.url=null!=r&&"undefined"!=r?r:null,a},this.updateCSRMenuinHeader=function(){dojo.xhrGet({url:getAbsoluteURL()+"BPSGetCSRDetailsView",content:{storeId:WCParamJS.storeId},handleAs:"json",load:function(e){CSRWCParamJS.env_shopOnBehalfSessionEstablished=e.env_shopOnBehalfSessionEstablished,CSRWCParamJS.env_shopOnBehalfEnabled_CSR=e.env_shopOnBehalfEnabled_CSR,"true"===CSRWCParamJS.env_shopOnBehalfEnabled_CSR&&("true"===CSRWCParamJS.env_shopOnBehalfSessionEstablished?(dojo.byId("customerServiceLink_restore").style.display="",dojo.byId("customerServiceLink").style.display="none",dojo.byId("customerServiceLink_restore_1").style.display="",dojo.byId("customerServiceLink_1").style.display="none",dojo.byId("customerServiceLink_restore_2").style.display="",dojo.byId("customerServiceLink_2").style.display="none",dojo.byId("customerServiceLink_restore_3").style.display="",dojo.byId("customerServiceLink_3").style.display="none",dojo.byId("customerServiceLink_restore_4").style.display="",dojo.byId("customerServiceLink_4").style.display="none",dojo.byId("customerServiceLink_restore_5").style.display="",dojo.byId("customerServiceLink_restore_6").style.display="",dojo.byId("customerServiceLink_restore_mobile").style.display="",dojo.byId("customerServiceLink_mobile").style.display="none"):(dojo.byId("customerServiceLink").style.display="",dojo.byId("customerServiceLink_restore").style.display="none",dojo.byId("customerServiceLink_restore_1").style.display="none",dojo.byId("customerServiceLink_1").style.display="",dojo.byId("customerServiceLink_restore_2").style.display="none",dojo.byId("customerServiceLink_2").style.display="",dojo.byId("customerServiceLink_restore_3").style.display="none",dojo.byId("customerServiceLink_3").style.display="",dojo.byId("customerServiceLink_restore_4").style.display="none",dojo.byId("customerServiceLink_4").style.display="",dojo.byId("customerServiceLink_restore_5").style.display="none",dojo.byId("customerServiceLink_restore_6").style.display="none",dojo.byId("customerServiceLink_mobile").style.display="",dojo.byId("customerServiceLink_restore_mobile").style.display="none"),dojo.byId("mobileCustServDiv").style.display="")},error:function(e,r){}})},this.csrProceedCheck=function(){return"undefined"!=typeof CSRWCParamJS?"true"!=CSRWCParamJS.env_shopOnBehalfEnabled_CSR||"false"!=CSRWCParamJS.env_shopOnBehalfSessionEstablished:(console.debug("CSRWCParamJS not available."),!0)}}}),dojo.addOnLoad(function(){onBehalfUtilitiesJS=new OnBehalfUtilities,window.csrTimerJS={startCSRTimers:function(){window.csrWarningTimer=setTimeout("csrTimerJS.idleCSRWarning()",CSRWCParamJS.csrTimeoutSec)},resetCSRTimers:function(){clearTimeout(csrWarningTimer),this.startCSRTimers()},idleCSRWarning:function(){onBehalfUtilitiesJS.showCSRWarningPopup(),csrLogoutTimer=new dojox.timing.Timer(1e3),csrLogoutTimer.onTick=function(){byId("csrTimeoutVal")&&(parseInt(byId("csrTimeoutVal").innerText)>0?byId("csrTimeoutVal").innerText=parseInt(byId("csrTimeoutVal").innerText)-1:(csrLogoutTimer.stop(),require(["dijit/registry","dojo/dom","dojo/on","dojo/topic","dojo/_base/event"],function(e,r,o,t){t.publish("onBehalfSessionTimeout",{action:"YES"}),e.byId("confirmationPopup").hide()})))},csrLogoutTimer.start()}}}),"undefined"!=typeof wc&&(wc.render.declareContext("orderLockStatusContext",{},""),wc.render.declareContext("onBehalfCommonContext",{},""),wc.render.declareRefreshController({id:"orderLockStatusController",renderContext:wc.render.getContextById("orderLockStatusContext"),url:"",baseURL:getAbsoluteURL()+"OrderLockStatusView",formId:"",modelChangedHandler:function(e,r){console.debug("modelChangedHandler of orderLockStatusController",r);var o=this.renderContext;this.url=this.baseURL+"?"+getCommonParametersQueryString(),"AjaxRESTOrderLockUnlockOnBehalf"==e.actionId&&r.refresh(o.properties)},renderContextChangedHandler:function(e,r){console.debug("renderContextChangedHandler of orderLockStatusController",r)},postRefreshHandler:function(e){console.debug("Post refresh handler of orderLockStatus",e),cursor_clear()}}),wc.service.declare({id:"AjaxRESTMemberPasswordResetByAdminOnBehalfForBuyer",actionId:"AjaxRESTMemberPasswordResetByAdminOnBehalfForBuyer",url:getAbsoluteURL()+"AjaxRESTMemberPasswordResetByAdminOnBehalf",formId:"",successHandler:function(e){MessageHelper.displayStatusMessage(storeNLS.RESET_PASSWORD_SUCCESS),cursor_clear()},failureHandler:function(e){var r=storeNLS[e.errorMessageKey];null==r&&(e.errorMessage?r=e.errorMessage:e.errorMessageKey&&(r=e.errorMessageKey)),MessageHelper.displayErrorMessage(r)}}),wc.service.declare({id:"AjaxPromotionCodeDelete_CSR",actionId:"AjaxPromotionCodeManage",url:getAbsoluteURL()+"AjaxRESTPromotionCodeRemove",formId:"",successHandler:function(e){if("true"==byId("env_currentOrderLocked").value){if(byId("currentOrderId"))var r=byId("currentOrderId").value;else if(document.getElementsByClassName("currentOrderId")[0])r=document.getElementsByClassName("currentOrderId")[0].value;else r=getCookie("WC_CartOrderId_"+WCParamJS.storeId);onBehalfUtilitiesJS.unLockOrder(r,"","true")}clearCookieOnLogout(["WC_USER_PAGE_SIZE","WC_BPS_SHIPMODE","WC_Total_Points","WC_USERDETAILS"]),clearWCCartCookieOnLogout(),GlobalLoginShopOnBehalfJS.clearUserSetInSessionAndLogoff(byId("Logon_LogoutURLOriginal_Reg_href").value)},failureHandler:function(e){if(console.log("fail AjaxPromotionCodeDelete_CSR"),"true"==byId("env_currentOrderLocked").value){if(byId("currentOrderId"))var r=byId("currentOrderId").value;else if(document.getElementsByClassName("currentOrderId")[0])r=document.getElementsByClassName("currentOrderId")[0].value;else r=getCookie("WC_CartOrderId_"+WCParamJS.storeId);onBehalfUtilitiesJS.unLockOrder(r,"","true")}clearCookieOnLogout(["WC_USER_PAGE_SIZE","WC_BPS_SHIPMODE","WC_Total_Points","WC_USERDETAILS"]),clearWCCartCookieOnLogout(),GlobalLoginShopOnBehalfJS.clearUserSetInSessionAndLogoff(byId("Logon_LogoutURLOriginal_Reg_href").value)}}),wc.service.declare({id:"AjaxPromotionCodeDelete_FROM_CSR_ACCOUNT",actionId:"AjaxPromotionCodeManage",url:getAbsoluteURL()+"AjaxRESTPromotionCodeRemove",formId:"",successHandler:function(e){clearCookieOnLogout(["WC_USER_PAGE_SIZE","WC_BPS_SHIPMODE","WC_Total_Points","WC_USERDETAILS"]),clearWCCartCookieOnLogout(),logout(byId("Logon_LogoutURLOriginal_Reg_href").value)},failureHandler:function(e){console.log("fail AjaxPromotionCodeDelete_FROM_CSR_ACCOUNT"),clearCookieOnLogout(["WC_USER_PAGE_SIZE","WC_BPS_SHIPMODE","WC_Total_Points","WC_USERDETAILS"]),clearWCCartCookieOnLogout(),logout(byId("Logon_LogoutURLOriginal_Reg_href").value)}}),wc.service.declare({id:"AjaxRESTMemberPasswordResetByAdminOnBehalf",actionId:"AjaxRESTMemberPasswordResetByAdminOnBehalf",url:getAbsoluteURL()+"AjaxRESTMemberPasswordResetByAdminOnBehalf",formId:"",successHandler:function(e){MessageHelper.displayStatusMessage(storeNLS.RESET_PASSWORD_SUCCESS),"undefined"!=typeof registeredCustomersJS&&registeredCustomersJS.onResetPasswordByAdminSuccess(),cursor_clear()},failureHandler:function(e){var r="";"undefined"!=typeof registeredCustomersJS&&(null==(r=storeNLS[e.errorMessageKey])&&(e.errorMessage?r=e.errorMessage:e.errorMessageKey&&(r=e.errorMessageKey)),registeredCustomersJS.onResetPasswordByAdminError(r,e))}}),wc.service.declare({id:"AjaxRESTMemberPasswordResetByAdmin",actionId:"AjaxRESTMemberPasswordResetByAdmin",url:getAbsoluteURL()+"AjaxRESTMemberPasswordResetByAdmin",formId:"",successHandler:function(e){MessageHelper.displayStatusMessage(storeNLS.RESET_PASSWORD_SUCCESS),cursor_clear()},failureHandler:function(e){MessageHelper.displayErrorMessage(storeNLS.ERROR_RESET_PASSWORD_ACCESS_ACCOUNT_TO_RESET)}}),wc.service.declare({id:"AjaxCancelOrderAdministrator",actionId:"AjaxCancelOrderAdministrator",url:getAbsoluteURL()+"AjaxRESTCSROrderCancelAsAdmin?"+getCommonParametersQueryString()+"&forcedCancel=true",formId:"",successHandler:function(e){MessageHelper.displayStatusMessage(storeNLS.ORDER_CANCEL_SUCCESS);var r=wc.render.getContextById("onBehalfCommonContext").properties.cancelReloadURL;""!=r&&void 0!==r?document.location.href=r:window.location.reload(1),cursor_clear()},failureHandler:function(e){e.errorMessage?MessageHelper.displayErrorMessage(e.errorMessage):e.errorMessageKey&&MessageHelper.displayErrorMessage(e.errorMessageKey)}}));