var recentProductMetrics=null,recentCategoryMetrics=null,recentESpotMetrics=null,eventSource=null,eventOrigin=null,nlsText=null,ciInventoryView=!1,lastSubOverlayId=null,productHooks=[],categoryHooks=[],espotHooks=[],ESPOT_THRESHOLD=130,CAT_THRESHOLD=50,categoryTimeoutInit=!1,productTimeoutInit=!1,espotTimeoutInit=!1,hideReOrderLink=!1;function removeSpaceFromId(e){return e.split(" ").join("--_-")}function addSpaceToId(e){return e.split("--_-").join(" ")}function encodeId(e){return e}function decodeId(e){return e}function openWatch(e){eventSource&&eventOrigin&&eventSource.postMessage(JSON.stringify({cmd:"open_watch",partNumber:e}),eventOrigin)}function editProduct(e){eventSource&&eventOrigin&&eventSource.postMessage(JSON.stringify({cmd:"edit_product",partNumber:e}),eventOrigin)}function editCategory(e){eventSource&&eventOrigin&&eventSource.postMessage(JSON.stringify({cmd:"edit_category",categoryIdentifier:e}),eventOrigin)}function reOrder(e){eventSource&&eventOrigin&&eventSource.postMessage(JSON.stringify({cmd:"re_order",categoryIdentifier:e}),eventOrigin)}function changeStoreViewLanguage(e){eventSource&&eventOrigin&&eventSource.postMessage(JSON.stringify({cmd:"change_language",languageId:e}),eventOrigin)}function showInfo(e){require(["dojo/dom"],function(i){var t=i.byId("ci_widgetSuffix_espot_"+e),o=void 0,a=void 0,r=void 0;if(t){var n=/^(-\d|\d)\d*$/;o=t.innerHTML.split("_"),n.test(o[4])&&n.test(o[3])&&(a=o[4],r=o[3])}var s=void 0,d=i.byId("ci_previewreport_espot_"+e);d&&(s=JSON.parse(d.innerHTML)),eventSource.postMessage(JSON.stringify({cmd:"show_info",previewReport:s,layoutId:a,widgetId:r}),eventOrigin)})}function getOverlayType(e){return e.split("_")[1]}function processTap(e){if(0===e.currentTarget.id.indexOf("ci_"))if("a"===e.target.tagName.toLowerCase())0===e.target.id.indexOf("next")?overlayNext(e.currentTarget.id):0===e.target.id.indexOf("prev")&&overlayPrev(e.currentTarget.id);else if("a"===e.target.parentElement.tagName.toLowerCase()){var i=e.target.parentElement;-1!==i.href.indexOf("editCategory")?editCategory(addSpaceToId(e.currentTarget.id.split("_").splice(2).join("_"))):-1!==i.href.indexOf("editProduct")?editProduct(e.currentTarget.id.split("_").splice(2).join("_")):-1!==i.href.indexOf("reOrder")?reOrder(addSpaceToId(e.currentTarget.id.split("_").splice(2).join("_"))):-1!==i.href.indexOf("showInfo")?showInfo(e.currentTarget.id.split("_").splice(2).join("_")):-1!==i.href.indexOf("openWatch")&&openWatch(e.currentTarget.id.split("_").splice(2).join("_"))}else toggleSubOverlay(e.currentTarget.id),dojo.stopEvent(e)}function processSwipe(e,i){e<-50?dojo.hasClass("next_"+i,"ci_not_visible")||overlayNext(i):e>50&&(dojo.hasClass("prev_"+i,"ci_not_visible")||overlayPrev(i))}function calculatePagingSize(e){var i=dojo.position(dojo.query(".ci_data",e).parent()[0]).w,t=dojo.position(dojo.query(".ci_data",e).parent()[0]).h,o=dojo.query(".ci_data > ul > li",e),a=getOverlayType(e),r=0;if(a&&"product"===a)r=1;else{if(a&&"espot"===a){if(t>ESPOT_THRESHOLD){var n=[325,490,630,775,925,1050,1210,1375,1510,1660,1825,2e3,2200,2400,2600,2800];do{}while(r<n.length&&i>n[r++]+Math.floor(200/r))}}else if(a&&"category"===a)if(t>CAT_THRESHOLD)r=1;else{var s;s=isAndroid()||isIOS()?[400,650,840,1140,1367,1600,1855]:[650,840,1140,1367,1600,1855,2065,2270,2475,2660,2840,3010,3200];do{}while(r<s.length&&i>s[r++]+Math.floor(100/r))}if(0===r){var d=[400,550,800,950,1100,1325,1600,1825,1950,2150];do{}while(r<d.length&&i>d[r++]+25)}}var c=0;return a&&"espot"===a?c=1:dojo.some(o,function(e,i){if(dojo.hasClass(e,"ci_hidden")){if(dojo.removeClass(e,"ci_hidden"),!(dojo.position(e).h<=t&&t>0))return dojo.addClass(e,"ci_hidden"),!0;t-=dojo.position(e).h,c++,dojo.addClass(e,"ci_hidden")}else{if(!(dojo.position(e).h<=t&&t>0))return!0;t-=dojo.position(e).h,c++}a&&("product"===a||"category"===a)&&c>1&&(t-=10)}),r*c}function overlayNext(e){var i=calculatePagingSize(e),t=(getOverlayType(e),dojo.query(".ci_data > ul > li",e));dojo.some(t,function(o,a){if(dojo.hasClass(o,"ci_show")){if(a+i>=t.length-i&&dojo.addClass("next_"+e,"ci_not_visible"),a<=t.length-i){var r=0;do{dojo.toggleClass(t[a+r],"ci_show"),dojo.toggleClass(t[a+r],"ci_hidden"),r++}while(t[a+r]&&dojo.hasClass(t[a+r],"ci_show")&&r<i);var n=0;for(k=0;k<i;k++)if(t[a+r+k]){var s=dojo.attr(t[a+r+k],"metricId");"itemsSold"!==s&&"itemSales"!==s||(n=1,dojo.query(".ci_data > ul > li[metricId$='"+s+"_p']",e).length>0&&n++,dojo.query(".ci_data > ul > li[metricId$='"+s+"_apv']",e).length>0&&n++),0!=n&&i>=n?n<=i-k&&(dojo.toggleClass(t[a+r+k],"ci_show"),dojo.toggleClass(t[a+r+k],"ci_hidden"),n--):(dojo.toggleClass(t[a+r+k],"ci_show"),dojo.toggleClass(t[a+r+k],"ci_hidden"))}dojo.hasClass("prev_"+e,"ci_not_visible")&&dojo.removeClass("prev_"+e,"ci_not_visible")}return!0}})}function overlayPrev(e){var i=calculatePagingSize(e),t=dojo.query(".ci_data > ul > li",e);dojo.some(t,function(o,a){if(dojo.hasClass(o,"ci_show")){if(a-i<=0&&dojo.addClass("prev_"+e,"ci_not_visible"),a-i>=0-i){var r=0;do{dojo.toggleClass(t[a+r],"ci_show"),dojo.toggleClass(t[a+r],"ci_hidden"),r++}while(t[a+r]&&dojo.hasClass(t[a+r],"ci_show")&&r<i);var n=0;for(k=1;k<=i;k++)if(t[a-k]){var s=dojo.attr(t[a-k],"metricId");if(-1!=s.lastIndexOf("_p")||-1!=s.lastIndexOf("_apv")){if(++n===i)for(l=0;l<n;l++)dojo.toggleClass(t[a-k+l],"ci_show"),dojo.toggleClass(t[a-k+l],"ci_hidden")}else if("itemsSold"===s||"itemSales"===s){if(++n<=i)for(l=0;l<n;l++)dojo.toggleClass(t[a-k+l],"ci_show"),dojo.toggleClass(t[a-k+l],"ci_hidden");n=0}else dojo.toggleClass(t[a-k],"ci_show"),dojo.toggleClass(t[a-k],"ci_hidden")}dojo.hasClass("next_"+e,"ci_not_visible")&&dojo.removeClass("next_"+e,"ci_not_visible")}return!0}})}function getCIClassSize(e){var i=dojo.position(e).w;return i<320?"ci_xxs":i<768?"ci_xs":i<992?"ci_sm":i<1200?"ci_md":"ci_lg"}function toggleSubOverlay(e){var i=dojo.query('div[id^="'+encodeId(e)+'"]  div[class*="ci_sub_overlay_"]')[0];if(i){if(null!=lastSubOverlayId&&lastSubOverlayId!=e){var t=dojo.query('div[id^="'+encodeId(lastSubOverlayId)+'"]  div[class*="ci_sub_overlay_"]')[0];dojo.addClass(t,"ci_not_visible")}dojo.toggleClass(i,"ci_not_visible"),lastSubOverlayId=dojo.hasClass(i,"ci_not_visible")?null:e}}function toggleCIInventoryView(){var e=dojo.query('div[id^="ci_product_"]');ciInventoryView?e.forEach(function(e){var i=dojo.position(e);if(dojo.addClass(e,"ci_inventory"),i.h>0&&i.w>0){var t=dojo.query(".ci_overlay.ci_inventory_overlay",e)[0];t&&drawCIInventory(t)}}):e.forEach(function(e){dojo.removeClass(e,"ci_inventory")})}function drawCIInventory(e){var i=dojo.position(e),t=i.h,o=i.w;dojo.query(".ci_inventory_info",e).style({width:o+"px",height:t+"px",padding:"0"});var a=dojo.query(".ci_child_inventory_info",e)[0],r=dojo.position(a),n=1.1*(t/2-r.h/2),s=o/2-r.w/2;dojo.style(a,{top:n+"px",left:s+"px",visibility:"visible"});var d=e.getAttribute("data-percentage");if(d){var c=dojo.query("canvas",e)[0],l=Number(d),v=(Math.min(.8*o,.8*t)-6)/2,u=c.getContext("2d");c.setAttribute("width",o),c.setAttribute("height",t),u.clearRect(0,0,o,t),u.beginPath(),u.lineWidth=6,u.strokeStyle="white",u.arc(o/2,t/2,v,1.5*Math.PI,(1.5+2*l)*Math.PI),u.stroke(),u.beginPath(),u.lineWidth=6,u.strokeStyle="grey",u.arc(o/2,t/2,v,(1.5+2*l)*Math.PI,1.5*Math.PI),u.stroke()}}function showProductOverlay(e){for(var i in productTimeoutInit||(dojo.subscribe("CIRefreshProductOverlay",function(){setTimeout(function(){showProductOverlay(_addEmptyMetrics(recentProductMetrics,"product")),toggleCIInventoryView()},250)}),require(["dojo/on","dojo/topic"],function(e,i){isAndroid()||isIOS()||window.addEventListener("resize",function(e){var i;clearTimeout(i),i=setTimeout(function(){ciInventoryView||showProductOverlay(_addEmptyMetrics(recentProductMetrics,"product")),toggleCIInventoryView()},500)},!1),i.subscribe("CIRefreshProductOverlay",function(){setTimeout(function(){showProductOverlay(_addEmptyMetrics(recentProductMetrics,"product")),toggleCIInventoryView()},250)})}),productTimeoutInit=!0),recentProductMetrics=e,e){var t=dojo.byId("ci_product_"+encodeId(e[i].partNumber));if(t){dojo.style(t.parentNode,"position","relative"),dojo.query("> .ci_overlay_root",t).forEach(dojo.destroy);var o="<div class='ci_overlay_root'>";dojo.position(t).h>320?o+="<div class='ci_overlay products ci_sub_overlay_top_large ci_not_visible "+getCIClassSize(t.id)+"'>":dojo.position(t).h>290?o+="<div class='ci_overlay products ci_sub_overlay_top_medium ci_not_visible "+getCIClassSize(t.id)+"'>":o+="<div class='ci_overlay products ci_sub_overlay_top_small ci_not_visible "+getCIClassSize(t.id)+"'>",o+="<div class='ci_actions'>",o+="<ul>",o+="<li><span title='"+e[i].partNumber.split("_").slice(1).join("_")+"'>"+e[i].partNumber.split("_").slice(1).join("_")+"</span></li>",o+="<li><a role='button' href='javascript:openWatch(\""+encodeId(e[i].partNumber)+"\");'><div class='watch_icon action_icons'></div><span title='"+nlsText.watch+"'>"+nlsText.watch+"</span></a></li>",o+="<li><a role='button' href='javascript:editProduct(\""+encodeId(e[i].partNumber)+"\");'><div class='edit_icon action_icons'></div><span title='"+nlsText.edit+"'>"+nlsText.edit+"</span></a></li>",o+="</ul>",o+="</div>",o+="</div>";var a="ci_overlay_tall_rect_small";dojo.position(t).h>320?a="ci_overlay_tall_rect_large":dojo.position(t).h>290&&(a="ci_overlay_tall_rect_medium"),o+="<div class='ci_overlay products "+a+" "+getCIClassSize(t.id)+"'>",o+="<div class='ci_data'>",o+="<a id='prev_"+t.id+"' class='ci_left_arrow ci_not_visible' href='javascript:overlayPrev(\""+t.id+"\");'><span></span></a>",o+="<a id='next_"+t.id+"' class='ci_right_arrow' href='javascript:overlayNext(\""+t.id+"\");'><span></span></a>",o+="<ul onclick='javascript:toggleSubOverlay(\""+t.id+"\");'>";for(var r=!0,n=0;n<Object.keys(e[i]).length;n++)for(var s in e[i])switch(s){default:e[i][s].order===n&&(r=!1,"itemSales"===s||"itemsSold"===s?(e[i][s].a&&(o+="<li metricId='"+s+"' class='ci_hidden'>",o+="<span title='"+e[i][s].name+"'>"+e[i][s].name+"</span>",o+="<span title='"+e[i][s].a+"'>"+e[i][s].a+"</span>",o+="</li>"),e[i][s].p&&(o+="<li metricId='"+s+"_p' class='ci_hidden'>",o+="<span title='"+nlsText.plan+"'>"+nlsText.plan+"</span>",o+="<span title='"+e[i][s].p+"'>"+e[i][s].p+"</span>",o+="</li>"),e[i][s].apv&&(o+="<li metricId='"+s+"_apv' class='ci_hidden'>",o+="<span title='"+nlsText.variance+"'>"+nlsText.variance+"</span>",o+="<span title='"+e[i][s].apv+"'>"+e[i][s].apv+"</span>",o+="</li>")):(o+="<li metricId='"+s+"' class='ci_hidden'>",o+="<span title='"+e[i][s].name+"'>"+e[i][s].name+"</span>",e[i][s].a?o+="<span title='"+e[i][s].a+"'>"+e[i][s].a+"</span>":o+="<span title='"+e[i][s]+"'>"+e[i][s]+"</span>",o+="</li>"));case"partNumber":case"parentCategoryIdentifier":case"rank":case"totalInventory":case"displayInventoryOnhandPercentage":case"inventoryOnHand":case"inventoryOnOrder":case"inventoryOnHandPercentage":break;case"data":"none"===e[i][s]&&0===n&&(r=!1,o+="<li metricId='no_data' class='ci_hidden'>"+nlsText.nodata+"</li>")}if(r&&(o+="<li metricId='no_data' class='ci_hidden'>"+nlsText.nodata+"</li>"),o+="</ul>",o+="</div>",o+="</div>",e[i].data&&"none"===e[i].data)o+="<div class='ci_overlay ci_inventory_overlay "+a+"' id='inventory_"+t.id+"'",o+=" onclick='javascript:toggleSubOverlay(\""+t.id+"\");'>",o+="<div class='ci_inventory_info'>",o+="<div class='ci_child_inventory_info' style='visibility: hidden;'>",o+="<span title='"+nlsText.nodata+"'>"+nlsText.nodata+"</span>",o+="</div>",o+="</div>",o+="</div>";else{var d=e[i].totalInventory||nlsText.undefinedValue,c=e[i].inventoryOnHandPercentage,l=e[i].displayInventoryOnhandPercentage||nlsText.undefinedValue;o+="<div class='ci_overlay ci_inventory_overlay "+a+"' id='inventory_"+t.id+"'",o+="' data-percentage='"+c+"'",o+=" onclick='javascript:toggleSubOverlay(\""+t.id+"\");'>",o+="<canvas id='inventory_canvas_"+t.id+"'></canvas>",o+="<div class='ci_inventory_info'>",o+="<div class='ci_child_inventory_info' style='visibility: hidden;'>",o+="<span title='"+l+"' class='percentage'>"+l+"</span>",o+="<span title='"+nlsText.ofSKUsInStock+"'>"+nlsText.ofSKUsInStock+"</span>",o+="<span title='"+d+"' class='inventory'>"+d+"</span>",o+="<span title='"+nlsText.units+"'>"+nlsText.units+"</span>",o+="</div>",o+="</div>",o+="</div>",(isAndroid()||isIOS())&&require(["dojo/on","dojox/gesture/swipe","dojox/gesture/tap","dojo/_base/event"],function(e,i,o,a){e(t,o,function(e){processTap(e)}),e(t,i.end,function(e){processSwipe(e.dx,e.currentTarget.id)})})}if(o+="</div>",dojo.query(t).closest(".productListingWidget").length>0)if(e[i].rank)dojo.query("> .ci_overlay_triangle",t).forEach(dojo.destroy),o+="<div class='ci_overlay_triangle "+(e[i].color?e[i].color:"")+"'>",o+="<span title='"+e[i].rank+"'>"+e[i].rank+"</span>",o+="</div>";else dojo.query("> .ci_overlay_triangle",t).forEach(dojo.destroy);dojo.place(o,t,"first");var v=calculatePagingSize(t.id);dojo.query(".ci_data > ul > li",t).length<=v&&dojo.toggleClass(dojo.byId("next_"+t.id),"ci_not_visible"),dojo.some(dojo.query(".ci_data > ul > li",t),function(e,i){var o=dojo.attr(e,"metricId");if("itemsSold"===o||"itemSales"===o){var a=1;if(dojo.query(".ci_data > ul > li[metricId$='"+o+"_p']",t).length>0&&a++,dojo.query(".ci_data > ul > li[metricId$='"+o+"_apv']",t).length>0&&a++,a>v)return!0}if(0==v--)return!0;dojo.toggleClass(e,"ci_show"),dojo.toggleClass(e,"ci_hidden")})}}}function showCategoryOverlay(e,i){for(var t in categoryTimeoutInit||(dojo.subscribe("CIRefreshProductOverlay",function(){setTimeout(function(){showProductOverlay(_addEmptyMetrics(recentProductMetrics,"product")),toggleCIInventoryView()},250)}),require(["dojo/on","dojo/topic"],function(e,i){isAndroid()||isIOS()||window.addEventListener("resize",function(e){var i;clearTimeout(i),i=setTimeout(function(){showCategoryOverlay(_addEmptyMetrics(recentCategoryMetrics,"category")),toggleCIInventoryView()},500)},!1),i.subscribe("CIRefreshProductOverlay",function(){setTimeout(function(){showProductOverlay(_addEmptyMetrics(recentProductMetrics,"product")),toggleCIInventoryView()},250)})}),categoryTimeoutInit=!0),recentCategoryMetrics=e,e){var o=dojo.query('div[id^="ci_category_'+removeSpaceFromId(e[t].categoryIdentifier)+'"]')[0];if(o){dojo.style(o.parentNode,"position","relative"),dojo.query("> .ci_overlay",o).forEach(dojo.destroy);var a="";dojo.position(o).h<100?a+="<div class='ci_overlay category ci_sub_overlay_stack ci_not_visible "+getCIClassSize(o.id)+"'>":a+="<div class='ci_overlay products ci_sub_overlay_top_small ci_not_visible "+getCIClassSize(o.id)+"'>";var r=hideReOrderLink?"":"<a class='ci_reorder_link' href='javascript:reOrder(\""+e[t].categoryIdentifier+"\");'><div class='reorder_icon action_icons'></div><span title='"+nlsText.reorder+"'>"+nlsText.reorder+"</span></a>";a+="<div class='ci_actions'><a href='javascript:editCategory(\""+e[t].categoryIdentifier+"\");'><div class='edit_icon action_icons'></div><span title='"+nlsText.edit+"'>"+nlsText.edit+"</span></a>"+r+"</div>",a+="</div>",dojo.position(o).h<100?a+="<div class='ci_overlay category ci_overlay_full_wide "+getCIClassSize(o.id)+"'>":a+="<div class='ci_overlay products ci_overlay_tall_rect_small "+getCIClassSize(o.id)+"'>",a+="<div class='ci_data'>",a+="<a id='prev_"+o.id+"' class='ci_left_arrow ci_not_visible' href='javascript:overlayPrev(\""+o.id+"\");'><span></span></a>",a+="<a id='next_"+o.id+"' class='ci_right_arrow' href='javascript:overlayNext(\""+o.id+"\");'><span></span></a>",a+="<ul onclick='javascript:toggleSubOverlay(\""+o.id+"\");'>";for(var n=!0,s=0;s<Object.keys(e[t]).length;s++)for(var d in e[t])switch(d){default:e[t][d].order===s&&(n=!1,"itemSales"===d||"itemsSold"===d?(e[t][d].a&&(a+="<li metricId='"+d+"' class='ci_hidden'>",a+="<span title='"+e[t][d].name+"'>"+e[t][d].name+":</span>",a+="<span title='"+e[t][d].a+"'>"+e[t][d].a+"</span>",a+="</li>"),e[t][d].p&&(a+="<li metricId='"+d+"_p' class='ci_hidden'>",a+="<span title='"+nlsText.plan+"'>"+nlsText.plan+":</span>",a+="<span title='"+e[t][d].p+"'>"+e[t][d].p+"</span>",a+="</li>"),e[t][d].apv&&(a+="<li metricId='"+d+"_apv' class='ci_hidden'>",a+="<span title='"+nlsText.variance+"'>"+nlsText.variance+":</span>",a+="<span title='"+e[t][d].apv+"'>"+e[t][d].apv+"</span>",a+="</li>")):(a+="<li metricId='"+d+"' class='ci_hidden'>",a+="<span title='"+e[t][d].name+"'>"+e[t][d].name+":</span>",e[t][d].a?a+="<span title='"+e[t][d].a+"'>"+e[t][d].a+"</span>":a+="<span title='"+e[t][d]+"'>"+e[t][d]+"</span>",a+="</li>"));case"categoryIdentifier":}n&&(a+="<li metricId='no_data' class='ci_hidden'>"+nlsText.nodata+"</li>"),a+="</ul>",a+="</div>",a+="</div>",dojo.place(a,o,"first");var c=calculatePagingSize(o.id);dojo.query(".ci_data > ul > li",o).length<=c&&dojo.toggleClass(dojo.byId("next_"+o.id),"ci_not_visible"),dojo.some(dojo.query(".ci_data > ul > li",o),function(e,i){var t=dojo.attr(e,"metricId");if("itemsSold"===t||"itemSales"===t){var a=1;if(dojo.query(".ci_data > ul > li[metricId$='"+t+"_p']",o).length>0&&a++,dojo.query(".ci_data > ul > li[metricId$='"+t+"_apv']",o).length>0&&a++,a>c)return!0}if(0==c--)return!0;dojo.toggleClass(e,"ci_show"),dojo.toggleClass(e,"ci_hidden")}),(isAndroid()||isIOS())&&require(["dojo/on","dojox/gesture/swipe","dojox/gesture/tap","dojo/_base/event"],function(e,i,t,a){e(o,t,function(e){processTap(e)}),e(o,i.end,function(e){processSwipe(e.dx,e.currentTarget.id)})})}}}function showESpotOverlay(e){espotTimeoutInit||(dojo.subscribe("CIRefreshProductOverlay",function(){setTimeout(function(){showESpotOverlay(_addEmptyMetrics(recentESpotMetrics,"espot")),toggleCIInventoryView()},250)}),require(["dojo/on","dojo/topic"],function(e,i){isAndroid()||isIOS()||window.addEventListener("resize",function(e){var i;clearTimeout(i),i=setTimeout(function(){showESpotOverlay(_addEmptyMetrics(recentESpotMetrics,"espot")),toggleCIInventoryView()},500)},!1),i.subscribe("CIRefreshProductOverlay",function(){setTimeout(function(){showESpotOverlay(_addEmptyMetrics(recentESpotMetrics,"espot")),toggleCIInventoryView()},250)})}),espotTimeoutInit=!0),recentESpotMetrics=e;var i=[];for(var t in e){var o=dojo.query('div[id^="ci_espot_'+encodeId(e[t].espotName)+'"]')[0];if(o){var a="";if(-1===i.indexOf(e[t].espotName)){if(dojo.style(o.parentNode,"position","relative"),dojo.query("> .ci_overlay",o).forEach(dojo.destroy),dojo.position(o).h>ESPOT_THRESHOLD?(a+="<div class='ci_overlay activities ci_sub_overlay_top_wide ci_not_visible "+getCIClassSize(o.id)+"'>",a+="<div class='ci_actions'><a role='button' href='javascript:showInfo(\""+e[t].espotName+"\");'><div class='info_icon action_icons'></div><span title='"+nlsText.information+"'>"+nlsText.information+"</span></a></div>",a+="</div>",a+="<div class='ci_overlay activities ci_overlay_wide_rect_small "+getCIClassSize(o.id)+"'>"):(a+="<div class='ci_overlay activities ci_sub_overlay_stack ci_not_visible "+getCIClassSize(o.id)+"'>",a+="<div class='ci_actions'><a href='javascript:showInfo(\""+e[t].espotName+"\");'><div class='info_icon action_icons'></div><span title='"+nlsText.information+"'>"+nlsText.information+"</span></a></div>",a+="</div>",a+="<div class='ci_overlay category ci_overlay_full_wide "+getCIClassSize(o.id)+"'>"),a+="<div class='ci_data'>",a+="<a id='prev_"+o.id+"' class='ci_left_arrow ci_not_visible' href='javascript:overlayPrev(\""+o.id+"\");'><span></span></a>",a+="<a id='next_"+o.id+"' class='ci_right_arrow' href='javascript:overlayNext(\""+o.id+"\");'><span></span></a>",dojo.position(o).h>ESPOT_THRESHOLD){if(a+="<ul onclick='javascript:toggleSubOverlay(\""+o.id+"\");'>",e[t].data&&"none"===e[t].data)a+="<li metricId='no_data' class='activity-slide ci_hidden'>",a+="<span class='heading' title='"+nlsText.nodata+"'>"+nlsText.nodata+"</span>";else{a+="<li metricId='espot' class='activity-slide ci_hidden'>",a+="<span class='heading' title='"+e[t].activityName+"'>"+e[t].activityName+"</span>",a+="<ul>";for(var r=0;r<Object.keys(e[t]).length;r++)for(var n in e[t])switch(n){default:e[t][n].order===r&&(a+="<li>",a+="<span title='"+e[t][n].name+"'>"+e[t][n].name+":</span>",e[t][n].value?a+="<span title='"+e[t][n].value+"'>"+e[t][n].value+"</span>":a+="<span title'"+e[t][n]+"'>"+e[t][n]+"</span>",a+="</li>");case"reportId":case"espotName":case"activityName":}a+="</ul>",(isAndroid()||isIOS())&&require(["dojo/on","dojox/gesture/swipe","dojox/gesture/tap","dojo/_base/event"],function(e,i,t,a){e(o,t,function(e){processTap(e)})})}a+="</li>",a+="</ul>"}else{if(a+="<ul onclick='javascript:toggleSubOverlay(\""+o.id+"\");'>",e[t].data&&"none"===e[t].data)a+="<li metricId='no_data' class='ci_hidden'>"+nlsText.nodata+"</li>";else{a+="<li metricId='activityName' class='ci_hidden'><span class='heading' title='"+e[t].activityName+"'>"+e[t].activityName+"</span></li>";for(r=0;r<Object.keys(e[t]).length;r++)for(var n in e[t])switch(n){default:e[t][n].order===r&&(a+="<li metricId='"+n+"' class='ci_hidden'>",a+="<span title='"+e[t][n].name+"'>"+e[t][n].name+":</span>",e[t][n].value?a+="<span title='"+e[t][n].value+"'>"+e[t][n].value+"</span>":a+="<span title='"+e[t][n]+"'>"+e[t][n]+"</span>",a+="</li>");case"reportId":case"espotName":case"activityName":}(isAndroid()||isIOS())&&require(["dojo/on","dojox/gesture/swipe","dojox/gesture/tap","dojo/_base/event"],function(e,i,t,a){e(o,t,function(e){processTap(e)}),e(o,i.end,function(e){processSwipe(e.dx,e.currentTarget.id)})})}a+="</li>",a+="</ul>"}a+="</div>",a+="</div>",dojo.place(a,o,"first");var s=dojo.query('div[id^="ci_espot_'+encodeId(e[t].espotName)+'"] .ci_overlay_wide_rect_small')[0];(isAndroid()||isIOS())&&void 0!==s&&require(["dojo/on","dojox/gesture/swipe","dojox/gesture/tap","dojo/_base/event"],function(e,i,t,o){e(s,i.end,function(e){processSwipe(e.dx,e.currentTarget.parentNode.id)})}),i.push(e[t].espotName)}else{var d=dojo.query("> .ci_overlay > .ci_data > ul",o)[0];if(dojo.position(o).h>ESPOT_THRESHOLD){a+="<li metricId='espot' class='activity-slide ci_hidden'>",a+="<span class='heading' title='"+e[t].activityName+"'>"+e[t].activityName+"</span>",a+="<ul>";for(r=0;r<Object.keys(e[t]).length;r++)for(var n in e[t])switch(n){default:e[t][n].order===r&&(a+="<li>",a+="<span title='"+e[t][n].name+"'>"+e[t][n].name+":</span>",e[t][n].value?a+="<span title='"+e[t][n].value+"'>"+e[t][n].value+"</span>":a+="<span title='"+e[t][n]+"'>"+e[t][n]+"</span>",a+="</li>");case"reportId":case"espotName":case"activityName":}a+="</ul>",a+="</li>"}else{a+="<li metricId='activityName' class='ci_hidden'><span class='heading' title='"+e[t].activityName+"'>"+e[t].activityName+"</span></li>";for(r=0;r<Object.keys(e[t]).length;r++)for(var n in e[t])switch(n){default:e[t][n].order===r&&(a+="<li metricId='"+n+"' class='ci_hidden'>",a+="<span title='"+e[t][n].name+"'>"+e[t][n].name+":</span>",e[t][n].value?a+="<span title='"+e[t][n].value+"'>"+e[t][n].value+"</span>":a+="<span title='"+e[t][n]+"'>"+e[t][n]+"</span>",a+="</li>");case"reportId":case"espotName":case"activityName":}a+="</li>"}dojo.place(a,d,"last")}var c=calculatePagingSize(o.id);dojo.query(".ci_data > ul > li",o).length<=c?dojo.addClass(dojo.byId("next_"+o.id),"ci_not_visible"):dojo.removeClass(dojo.byId("next_"+o.id),"ci_not_visible");var l=!1;dojo.some(dojo.query(".ci_data > ul > li",o),function(e,i){if(0==c--)return!0;if("activityName"===dojo.attr(e,"metricId")){if(l)return dojo.removeClass(dojo.byId("next_"+o.id),"ci_not_visible"),!0;l=!0}dojo.addClass(e,"ci_show"),dojo.hasClass(e,"ci_hidden")&&dojo.toggleClass(e,"ci_hidden")})}}}function _addEmptyMetrics(e,i){return e&&dojo.query('div[id^="ci_'+i+'"]').forEach(function(t,o,a){var r=t.getAttribute("id").split("_");switch(i){case"product":var n=r.slice(2).join("_");dojo.some(e,function(e){return e.partNumber===n||(-1!==n.indexOf("_"+e.partNumber,n.length-(e.partNumber.length+1))?(e.partNumber=n,!0):void 0)})||e.push({partNumber:n,data:"none"});break;case"category":n=addSpaceToId(r.slice(2).join("_"));dojo.some(e,function(e){if(e.categoryIdentifier===n)return!0})||e.push({categoryIdentifier:n,data:"none"});break;case"espot":n=r.slice(2).join("_");dojo.some(e,function(e){if(e.espotName===n)return!0})||e.push({espotName:n,data:"none"})}}),e}function retrieveCIHooks(){return productHooks=[],categoryHooks=[],espotHooks=[],dojo.query('div[id^="ci_"]').forEach(function(e,i,t){var o=e.getAttribute("id").split("_");if(o.length>=4&&("product"===o[1]||"category"===o[1]||"espot"===o[1]))switch(o[1]){case"product":productHooks.push(o.slice(2).join("_"));break;case"category":categoryHooks.push(o.slice(2,3)+"_"+addSpaceToId(o.slice(3).join("_")));break;case"espot":espotHooks.push(o.slice(2).join("_"))}}),[productHooks,categoryHooks,espotHooks,getPrimaryProduct()]}function getPrimaryProduct(){var e;return dojo.query('meta[name="pageGroup"]').forEach(function(e,i,t){if("Product"!==e.getAttribute("content"))return null}),dojo.query('meta[name="pageIdentifier"]').forEach(function(i,t,o){e=i.getAttribute("content")}),e}function receive(e){var i;try{i=JSON.parse(e.data)}catch(e){}if(i)switch(i.cmd){case"ack":initializeCIinventoryRedrawEvent(),nlsText=i.nlsText,e.source.postMessage(JSON.stringify({cmd:"request_metrics",hooks:JSON.stringify(retrieveCIHooks())}),e.origin),eventSource=e.source,eventOrigin=e.origin;break;case"response_metrics_product":ciInventoryView=i.inventoryView,showProductOverlay(_addEmptyMetrics(JSON.parse(i.metrics),"product")),ciInventoryView&&toggleCIInventoryView();break;case"response_metrics_category":showCategoryOverlay(_addEmptyMetrics(JSON.parse(i.metrics),"category"),e);break;case"response_metrics_espot":showESpotOverlay(_addEmptyMetrics(JSON.parse(i.metrics),"espot"));break;case"update_prefs":nlsText=i.nlsText;break;case"toggle_inventory_view":ciInventoryView!=i.inventoryView&&(ciInventoryView=i.inventoryView,toggleCIInventoryView());break;case"hide_reorder_link":hideReOrderLink=!0}}function initializeCIinventoryRedrawEvent(){require(["dojo/on","dojo/topic"],function(e,i){e(window,"resize",function(e){setTimeout(function(){var e=dojo.query('div[id^="ci_product_"]');ciInventoryView&&e.forEach(function(e){var i=dojo.position(e);if(i.h>0&&i.w>0){var t=dojo.query(".ci_overlay.ci_inventory_overlay",e)[0];t&&drawCIInventory(t)}})},300)}),i.subscribe("CIRefreshProductInventoryOverlay",function(){setTimeout(function(){var e=dojo.query('div[id^="ci_product_"]');ciInventoryView&&e.forEach(function(e){var i=dojo.position(e);if(i.h>0&&i.w>0){var t=dojo.query(".ci_overlay.ci_inventory_overlay",e)[0];t&&drawCIInventory(t)}})},200)})})}