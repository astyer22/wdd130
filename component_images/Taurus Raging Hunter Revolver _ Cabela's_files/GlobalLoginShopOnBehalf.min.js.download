GlobalLoginShopOnBehalfJS={USER_SEARCH_CRITERIA_TOPIC:"userSearchCriteriaChanged",firstNameSearchType:3,lastNameSearchType:3,updateTimer:null,timeOut:1e3,buyerSearchURL:"",loadedPanels:{},callerId:"",logoutURL:null,redirectURL:null,setCallerId:function(e){this.callerId=e},setBuyerSearchURL:function(e){this.buyerSearchURL=e},setControllerURL:function(e){wc.render.getRefreshControllerById("GlobalLoginShopOnBehalf_controller").url=e},registerShopOnBehalfPanel:function(e,o){this.loadedPanels[e]=o},isPageUsingHTTP:function(){return"http:"==document.location.protocol},initHTTPSecure:function(){var e="https://"+document.location.host+document.location.pathname;null!=document.location.search&&""!=document.location.search&&(e+=document.location.search),setCookie("WC_DisplayContractPanel_"+WCParamJS.storeId,!0,{path:"/",domain:cookieDomain}),setCookie("WC_ToogleOnBehalfPanel_"+WCParamJS.storeId,!0,{path:"/",domain:cookieDomain}),window.location.href=e},initializePanels:function(){if(null!=this.loadedPanels)for(var e in this.loadedPanels){null!=dojo.byId(e)&&this.initializePanel(e,this.loadedPanels[e])}},initializePanel:function(e,o){var r=require("dojo/dom-attr"),n=r.get(e,"isEventsSetup");if(null==n||!n){this.setUpEvents(e),r.set(e,"isEventsSetup",!0);var t=getCookie("WC_ToogleOnBehalfPanel_"+WCParamJS.storeId);null!=t&&t&&(this.toggleShopOnBehalfPanel(e+"_shopOnBehalfCheckBox",o,e),setCookie("WC_ToogleOnBehalfPanel_"+WCParamJS.storeId,null,{path:"/",expires:-1}))}var a="",i=dojo.byId(e+"_callerId");null!=i&&(a=i.innerHTML),this.setCallerId(a)},toggleShopOnBehalfPanel:function(e,o,r){if(this.isPageUsingHTTP())this.initHTTPSecure();else{require(["dojo/dom-attr","dojo/dom-style"],function(n,t){var a=n.get(e,"src");-1==a.indexOf("checked")?(n.set(e,"src",a.replace("checkbox","checkbox_checked")),t.set(o,"display","none"),t.set(r,"display","block")):(n.set(e,"src",a.replace("checkbox_checked","checkbox")),t.set(r,"display","none"),t.set(o,"display","block"))})}},setUpEvents:function(e){var o=this;require(["dojo/on","dojo/topic","dojo/dom-construct","dojo/dom","dojo/domReady!","dojo/dom-attr","dojo/dom-style"],function(r,n,t,a,i,l,s){var d=e+"_buyerUserName",c=e+"_errorLabel";console.debug("Setting up  on keyup event for DOM element = "+d+". ","Topic = "+o.USER_SEARCH_CRITERIA_TOPIC);var u=dojo.byId(d);null!=u&&(r(u,"keyup",function(e){var r={buyerSearchInput:u.value,"data-parent":l.get(u,"data-parent"),originator:u.id,searchErrorLabel:c};console.debug("publishing ",r),e.keyCode!=dojo.keys.TAB&&n.publish(o.USER_SEARCH_CRITERIA_TOPIC,r)}),n.subscribe(o.USER_SEARCH_CRITERIA_TOPIC,function(e){e.buyerSearchInput=u.value,console.debug("Clearing previous timers and starting a new one. Search results will updated after "+o.timeOut+" milliSeconds.",e),clearTimeout(o.updateTimer),o.updateTimer=setTimeout(dojo.hitch(o,"updateSearchResults",e),o.timeOut)}))})},updateSearchResults:function(e){if(console.debug("User input : ",e.buyerSearchInput),"undefined"!==e.buyerSearchInput){var o=new String(e.buyerSearchInput);e.lastName=o,this.performSearch(e)}},performSearch:function(e){var o=wc.render.getContextById("GlobalLoginShopOnBehalf_context"),r=e.lastName,n=o.properties.previousLastName;if(r!=n&&""!=r){if(o.properties.previousLastName=r,require("dojo/dom-style").set(e.originator+"Error","display","none"),setCurrentId(e.originator),!submitRequest())return;cursor_wait(),require(["dojo/request/xhr"],function(o){o(GlobalLoginShopOnBehalfJS.buyerSearchURL,{handleAs:"json",method:"GET",query:{lastName:r,lastNameSearchType:GlobalLoginShopOnBehalfJS.lastNameSearchType},headers:{"Content-Type":"text/plain; charset=utf-8"}}).then(function(o){cursor_clear(),GlobalLoginShopOnBehalfJS.displaySearchResults(o,e)},function(o){cursor_clear(),o.errorCode="GENERICERR_MAINTEXT",GlobalLoginShopOnBehalfJS.handleError(o,e)})})}else console.debug("input has not changed")},displaySearchResults:function(e,o){console.debug("Search results :",e);var r=this,n=document.getElementById(o.searchErrorLabel);require(["dojo/store/Memory"],function(t){var a=[],i=!1;require(["dojo/_base/config"],function(e){"ja-jp"!=e.locale&&"ko-kr"!=e.locale&&"zh-cn"!=e.locale&&"zh-tw"!=e.locale||(i=!0)});var l=require("dojo/_base/lang"),s=require("dojo/dom-class");if(null!=e&&null!=e.userDataBeans&&e.userDataBeans.length>0){s.remove(n,"active");for(var d=0;d<e.userDataBeans.length;d++){var c=e.userDataBeans[d];c.displayName="";var u="",h="";null!=c.firstName&&""!=l.trim(c.firstName)&&(u=i?" "+c.firstName:c.firstName+" "),null!=c.lastName&&""!=l.trim(c.lastName)&&(h=c.lastName),c.displayName=i?h+u:u+h,c.fullName=l.trim(c.displayName),c.displayName+=" ("+c.logonId+")",c.displayName=l.trim(c.displayName)}a=e.userDataBeans}else s.add(n,"active");var S=new t({idProperty:"userId",data:a});S.remove(r.callerId);var p=o.originator,f=dijit.byId(p);f.searchAttr="displayName",f.store=S,f.toggleDropDown()})},handleError:function(e,o){console.debug("An error occurred while searching for users ",e);var r=null;null!=e.errorMessage?r=e.errorMessage:null!=e.errorMessageKey?r=storeNLS[e.errorMessageKey]:null!=e.errorCode&&(r=storeNLS[e.errorCode]),null!=r&&""!=r||(r=storeNLS.GENERICERR_MAINTEXT),dojo.byId(o).innerHTML=r,require("dojo/dom-style").set(o,"display","block")},selectUser:function(e){var o=dijit.byId(e.id).item;if(null!=o&&"-1"!=o.userId){var r=wc.render.getContextById("GlobalLoginShopOnBehalf_context");if(r.properties.selectedUser=o,r.properties.shopOnBehalfPanelId=e["data-parent"],r.properties.shopForSelfPanelId=this.loadedPanels[e["data-parent"]],setCurrentId(e.id),!submitRequest())return;cursor_wait();var n=document.forms.shopOnBehalf_AuthTokenInfo.shopOnBehalf_AuthToken.value;wc.service.invoke("RunAsUserSetInSessionService",{runAsUserId:o.userId,authToken:n})}},onUserSetInSession:function(){var e=wc.render.getContextById("GlobalLoginShopOnBehalf_context").properties.selectedUser;setCookie("WC_BuyOnBehalf_"+WCParamJS.storeId,escapeXml(e.fullName,!0),{path:"/",domain:cookieDomain});var o=GlobalLoginJS.widgetsLoadedOnPage;if(null!=o&&o.length>0)for(var r=0;r<o.length;r++)this.updateSignOutLink(o[r]);setDeleteCartCookie(),setCookie("WC_DisplayContractPanel_"+WCParamJS.storeId,!0,{path:"/",domain:cookieDomain}),document.location.href="AjaxLogonForm?storeId="+WCParamJS.storeId+"&catalogId="+WCParamJS.catalogId+"&langId="+WCParamJS.langId+"&myAcctMain=1"},updateOrganization:function(e){var o=dijit.byId(e.id),r=o.value,n=wc.render.getContextById("GlobalLoginShopOnBehalf_context");n.properties.shopOnBehalfPanelId=o["data-parent"],n.properties.shopForSelfPanelId=this.loadedPanels[o["data-parent"]],setCurrentId(e.id),submitRequest()&&(cursor_wait(),wc.service.invoke("OrganizationSetInSessionService",{activeOrgId:r}))},updateContract:function(e){var o=dijit.byId(e.id),r=o.value,n=wc.render.getContextById("GlobalLoginShopOnBehalf_context");n.properties.shopOnBehalfPanelId=o["data-parent"],n.properties.shopForSelfPanelId=this.loadedPanels[o["data-parent"]],setCurrentId(o.id),submitRequest()&&(cursor_wait(),wc.service.invoke("ContractSetInSessionService",{contractId:r}))},clearUserSetInSession:function(e,o){null!=e&&""!=e&&setCurrentId(e.id),submitRequest()&&(cursor_wait(),this.logoutURL=null,this.redirectURL=o,wc.service.invoke("RestoreOriginalUserSetInSessionService"))},clearUserSetInSessionAndLogoff:function(e){submitRequest()&&(cursor_wait(),this.logoutURL=e,this.redirectURL=null,wc.service.invoke("RestoreOriginalUserSetInSessionService"))},restoreCSRSessionAndRedirect:function(e){GlobalLoginJS.deleteUserLogonIdCookie(),GlobalLoginShopOnBehalfJS.deleteBuyerUserNameCookie(),GlobalLoginShopOnBehalfJS.clearUserSetInSession("",e)},onRestoreUserSetInSession:function(){setCookie("WC_BuyOnBehalf_"+WCParamJS.storeId,null,{path:"/",expires:-1,domain:cookieDomain}),setDeleteCartCookie(),deleteOnBehalfRoleCookie(),"-1"!=this.redirectURL&&(null==this.logoutURL&&null==this.redirectURL?stringStartsWith(document.location.href,"https")?document.location.href=WCParamJS.homePageURL:document.location.reload():null!=this.redirectURL&&"-1"!=this.redirectURL?document.location.href=this.redirectURL:logout(this.logoutURL))},updateSignOutLink:function(e){var o=e+"_",r=dojo.byId(o+"signOutQuickLinkUser");if(null!=r){var n="",t=getCookie("WC_LogonUserId_"+WCParamJS.storeId);void 0!==t&&(n=t),r.innerHTML=escapeXml(n,!0);var a="",i=getCookie("WC_BuyOnBehalf_"+WCParamJS.storeId);void 0!==i&&(a=escapeXml(i,!0)),""!=a&&(r.innerHTML+=" ("+a+")")}},deleteBuyerUserNameCookie:function(){setCookie("WC_BuyOnBehalf_"+WCParamJS.storeId,null,{expires:-1,path:"/",domain:cookieDomain});var e=GlobalLoginJS.widgetsLoadedOnPage;if(null!=e&&e.length>0)for(var o=0;o<e.length;o++)this.updateSignOutLink(e[o])},resetBuyerUserNameCookie:function(e){setCookie("WC_BuyOnBehalf_"+WCParamJS.storeId,escapeXml(e,!0),{path:"/",domain:cookieDomain});var o=GlobalLoginJS.widgetsLoadedOnPage;if(null!=o&&o.length>0)for(var r=0;r<o.length;r++)this.updateSignOutLink(o[r])},resetDropdown:function(e){dijit.byId(e.id).reset()}},wc.render.declareContext("GlobalLoginShopOnBehalf_context",{previousLastName:null,firstName:null,lastName:null},""),wc.service.declare({id:"RunAsUserSetInSessionService",actionId:"RunAsUserSetInSession",url:"AjaxRunAsUserSetInSession",formId:"",successHandler:function(e){GlobalLoginShopOnBehalfJS.onUserSetInSession(),cursor_clear()},failureHandler:function(e){var o=wc.render.getContextById("GlobalLoginShopOnBehalf_context");GlobalLoginShopOnBehalfJS.handleError(e,o.properties.shopOnBehalfPanelId+"_ErrorField"),cursor_clear()}}),wc.service.declare({id:"OrganizationSetInSessionService",actionId:"OrganizationSetInSession",url:"AjaxOrganizationSetInSession",formId:"",successHandler:function(e){console.debug("Organization set in session successfully"),cursor_clear()},failureHandler:function(e){var o=wc.render.getContextById("GlobalLoginShopOnBehalf_context");GlobalLoginShopOnBehalfJS.handleError(e,o.properties.shopOnBehalfPanelId+"_ErrorField"),cursor_clear()}}),wc.service.declare({id:"ContractSetInSessionService",actionId:"ContractSetInSession",url:"AjaxContractSetInSession",formId:"",successHandler:function(e){cursor_clear()},failureHandler:function(e){var o=wc.render.getContextById("GlobalLoginShopOnBehalf_context");GlobalLoginShopOnBehalfJS.handleError(e,o.properties.shopOnBehalfPanelId+"_ErrorField"),cursor_clear()}}),wc.service.declare({id:"RestoreOriginalUserSetInSessionService",actionId:"RestoreOriginalUserSetInSessionService",url:"AjaxRestoreOriginalUserSetInSession?"+getCommonParametersQueryString(),formId:"",successHandler:function(e){if("undefined"!=typeof callCenterIntegrationJS&&void 0!=callCenterIntegrationJS&&null!=callCenterIntegrationJS){var o={status:"success"};o.serviceResponse=e,callCenterIntegrationJS.postActionMessage(o,"TERMINATE_ON_BEHALF_SESSION_RESPONSE")}GlobalLoginShopOnBehalfJS.onRestoreUserSetInSession(),cursor_clear()},failureHandler:function(e){if("undefined"!=typeof callCenterIntegrationJS&&void 0!=callCenterIntegrationJS&&null!=callCenterIntegrationJS){var o={status:"error"};o.serviceResponse=e,callCenterIntegrationJS.postActionMessage(o,"TERMINATE_ON_BEHALF_SESSION_RESPONSE")}var r=wc.render.getContextById("GlobalLoginShopOnBehalf_context");GlobalLoginShopOnBehalfJS.handleError(e,r.properties.shopOnBehalfPanelId+"_ErrorField"),cursor_clear()}}),wc.render.declareRefreshController({id:"GlobalLoginShopOnBehalf_controller",renderContext:wc.render.getContextById("GlobalLoginShopOnBehalf_context"),url:"",formId:"",renderContextChangedHandler:function(e,o){var r=this.renderContext;o.refresh(r.properties)},postRefreshHandler:function(e){var o=this.renderContext;delete o.properties.selectedUser,delete o.properties.firstName,delete o.properties.lastName,delete o.properties.previousFirstName,delete o.properties.previousLastName,delete o.properties.showOnBehalfPanel,GlobalLoginShopOnBehalfJS.initializePanels(),cursor_clear()}});