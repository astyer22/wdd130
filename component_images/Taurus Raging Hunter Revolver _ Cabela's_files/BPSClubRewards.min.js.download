if(null==BPSClubRewardsJS||"object"!=typeof BPSClubRewardsJS)var BPSClubRewardsJS=new Object;BPSClubRewardsJS={langId:"",storeId:"",catalogId:"",restContextPath:"",setCommonParameters:function(e,r,a,d){this.langId=e,this.storeId=r,this.catalogId=a,this.restContextPath=d},getCommonParameters:function(){return{langId:this.langId,storeId:this.storeId,catalogId:this.catalogId}},getRESTBaseURL:function(){var e=document.URL;e.substring(0,e.indexOf("://")),e.match(/:\/\/[^/]+/)[0].replace("://","");return document.URL.match(/http[s]{0,1}:\/\/[^/]+/)[0]+this.restContextPath+"/store/"+this.storeId},clubExclusiveValidDate:function(e,r){var a=new Date;return e=Number(e),r=Number(r),!isNaN(e)&&!isNaN(r)&&(!(e<1&&r<1)&&(!(e<1||e>12)&&(!(r<1)&&!(r<a.getFullYear()||r==a.getFullYear()&&e<=a.getMonth()))))},validDate:function(e,r){var a=new Date;return e=Number(e),r=Number(r),isNaN(e)||isNaN(r)?(dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML=applyODRStoreText.EDPPaymentMethods_INVALID_EXPIRY_DATE,!1):e<1&&r<1?(dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML=applyODRStoreText.EDPPaymentMethods_INVALID_EXPIRY_DATE,!1):e<1||e>12?(dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML=applyODRStoreText.EDPPaymentMethods_INVALID_EXPIRY_DATE,!1):r<1?(dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML=applyODRStoreText.EDPPaymentMethods_INVALID_EXPIRY_DATE,!1):!(r<a.getFullYear()||r==a.getFullYear()&&e<=a.getMonth())||(dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML=applyODRStoreText.EDPPaymentMethods_INVALID_EXPIRY_DATE,!1)},validateClubExSaveCardForm:function(){void 0!=byId("clubexculsiveAddCard")&&null!=byId("clubexculsiveAddCard")&&byId("BPS_OPC_Club_Rewards_LookUp_Error")&&""==byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML&&byId("clubexculsiveAddCard").classList.remove("not-active");var e=0,r=document.forms.AddClubExclusiveCardForm,a=r.addCardName.value;if("true"===CSRWCParamJS.env_shopOnBehalfEnabled_CSR)var d=r.cardNumber[0].value.replace(/\s/g,"");else d=r.cardNumber.value.replace(/\s/g,"");if(""==a?e+=1:""==d||isNaN(d)?e+=1:isNaN(r.expiryMonth.value)||isNaN(r.expiryYear.value)?e+=1:0==r.cardCVV.value.trim().length&&(e+=1),void 0!=byId("clubexculsiveAddCard")&&null!=byId("clubexculsiveAddCard")&&byId("BPS_OPC_Club_Rewards_LookUp_Error")&&0==e)dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML="",byId("clubexculsiveAddCard").classList.remove("not-active");else if(e>0)return dojo.byId("grayOut").style.display="block",void byId("clubexculsiveAddCard").classList.add("not-active")},validateClubExFraudAndProcessRequest:function(e,r){if(r){service=wc.service.getServiceById("AjaxClubExclusiveValidateFraudCCUsage");var a=[];a.storeId=this.storeId,a.action="Wallet_Add",cursor_wait(),wc.service.invoke("AjaxClubExclusiveValidateFraudCCUsage",a)}},addClubExclusiveCard:function(e,r){var a=document.getElementById("BPS_OPC_Club_Rewards_LookUp_Error"),d=document.forms[e.id];if(service=wc.service.getServiceById("AjaxAddClubExclusiveCardItem"),"true"===CSRWCParamJS.env_shopOnBehalfEnabled_CSR)var t=d.cardNumber[0].value.replace(/\s/g,"");else t=d.cardNumber.value.replace(/\s/g,"");var o=CheckoutPayments.getCardType(t);if(""==t)return MessageHelper.removeBPSAlertErrorId(),bpAlerts.createAlert("","BPS_OPC_Club_Rewards_LookUp_Error","after","error","",applyODRStoreText.BPS_OPC_ODR_CLUB_EXCLUSIVE_LOOKUP_ACC_MISSING,!0),a.style.display="block",addErrorRecord("3",d.cardNumber.id,applyODRStoreText.BPS_OPC_ODR_CLUB_EXCLUSIVE_LOOKUP_ACC_MISSING),void(dojo.byId("grayOut").style.display="block");if(isNaN(t))return MessageHelper.removeBPSAlertErrorId(),bpAlerts.createAlert("","BPS_OPC_Club_Rewards_LookUp_Error","after","error","",applyODRStoreText.BPS_OPC_ODR_CLUB_REWARD_LOOKUP_ACC_INVALID,!0),a.style.display="block",addErrorRecord("3",d.cardNumber.id,applyODRStoreText.BPS_OPC_ODR_CLUB_REWARD_LOOKUP_ACC_INVALID),void(dojo.byId("grayOut").style.display="block");if("Cabelas Club Visa"!=o&&"ClubMasterCard"!=o&&"CabelasClubMasterCard"!=o&&"ClubBusinessCard"!=o)return MessageHelper.removeBPSAlertErrorId(),bpAlerts.createAlert("","BPS_OPC_Club_Rewards_LookUp_Error","after","error","",applyODRStoreText.BPS_OPC_ODR_CLUB_EXCLUSIVE_REWARD_LOOKUP_ACC_INVALID,!0),a.style.display="block",addErrorRecord("3",d.cardNumber.id,applyODRStoreText.BPS_OPC_ODR_CLUB_EXCLUSIVE_REWARD_LOOKUP_ACC_INVALID),void(dojo.byId("grayOut").style.display="block");if(!BPSClubRewardsJS.clubExclusiveValidDate(d.expiryMonth.value,d.expiryYear.value))return MessageHelper.removeBPSAlertErrorId(),bpAlerts.createAlert("","BPS_OPC_Club_Rewards_LookUp_Error","after","error","",applyODRStoreText.BPS_OPC_ODR_CLUB_EXCLUSIVE_REWARD_LOOKUP_INVALID_DATE,!0),a.style.display="block",addErrorRecord("3",d.expiryMonth.id+"|"+d.expiryYear.id,""),void(dojo.byId("grayOut").style.display="block");if(0==d.cardCVV.value.trim().length)return MessageHelper.removeBPSAlertErrorId(),bpAlerts.createAlert("","BPS_OPC_Club_Rewards_LookUp_Error","after","error","",applyODRStoreText.BPSPaymentMethods_CLUB_CVV_NOT_EMPTY,!0),a.style.display="block",addErrorRecord("3",d.cardCVV.id,applyODRStoreText.BPSPaymentMethods_CLUB_CVV_NOT_EMPTY),void(dojo.byId("grayOut").style.display="block");if(null!=d.cardCVV.value&&!new RegExp("[*]{3,4}|[0-9]{3,4}").test(d.cardCVV.value)&&4!=d.cardCVV.value.length)return MessageHelper.removeBPSAlertErrorId(),bpAlerts.createAlert("","BPS_OPC_Club_Rewards_LookUp_Error","after","error","",applyODRStoreText.BPSEDPPaymentMethods_CVV_NOT_VALID,!0),a.style.display="block",addErrorRecord("3",d.cardCVV.id,applyODRStoreText.BPSEDPPaymentMethods_CVV_NOT_VALID),void(dojo.byId("grayOut").style.display="block");byId("BPS_OPC_Club_Rewards_LookUp_Error")&&(MessageHelper.removeBPSAlertErrorId(),dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML="");var l=BPSClubRewardsJS.getCommonParameters();l.requesttype="ajax",l.responseFormat="json",l.cardNumber=t,l.expiryDate=d.expiryMonth.value+d.expiryYear.value,l.cvv=d.cardCVV.value,l.options=0,l.saveClubCard="true",l.isTempClubCard="false",l.isAuthReqd="true",window.bpsAnalyticsErrorFieldId=e.id,submitRequest()&&(cursor_clear(),void 0!=r&&""!=(r=r.trim())?grecaptcha.execute(r,{action:"clubexclusiveaddcard"}).then(function(e){l["g-recaptcha-response"]=e,cursor_wait(),wc.service.invoke("AjaxAddClubExclusiveCardItem",l)}):(cursor_wait(),wc.service.invoke("AjaxAddClubExclusiveCardItem",l)))},verifyRecaptchaResponse:function(e,r){if(service=wc.service.getServiceById("AjaxClubExclusiveVerifyCaptchaResponse"),e.length>0){console.log("Set to verify captcha response");var a=[];a.storeId=this.storeId,a.captchaResponse=e,wc.service.invoke("AjaxClubExclusiveVerifyCaptchaResponse",a)}},addPaymentCard:function(e,r){var a=document.forms[e.id];if(service=wc.service.getServiceById("AjaxAddClubRewardsCardItem"),"true"===CSRWCParamJS.env_shopOnBehalfEnabled_CSR)var d=a.cardNumber[0].value.replace(/\s/g,"");else d=a.cardNumber.value.replace(/\s/g,"");var t=CheckoutPayments.getCardType(d);if(""==d)return dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML=applyODRStoreText.BPS_OPC_ODR_CLUB_REWARD_LOOKUP_ACC_MISSING,void addErrorRecord("3",a.cardNumber.id,applyODRStoreText.BPS_OPC_ODR_CLUB_REWARD_LOOKUP_ACC_MISSING);if(isNaN(d))return dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML=applyODRStoreText.BPS_OPC_ODR_CLUB_REWARD_LOOKUP_ACC_INVALID,void addErrorRecord("3",a.cardNumber.id,applyODRStoreText.BPS_OPC_ODR_CLUB_REWARD_LOOKUP_ACC_INVALID);if("Cabelas Club Visa"!=t&&"ClubMasterCard"!=t&&"CabelasClubMasterCard"!=t&&"ClubBusinessCard"!=t)return dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML=applyODRStoreText.BPS_OPC_ODR_CLUB_REWARD_LOOKUP_ACC_INVALID,void addErrorRecord("3",a.cardNumber.id,applyODRStoreText.BPS_OPC_ODR_CLUB_REWARD_LOOKUP_ACC_INVALID);if(BPSClubRewardsJS.validDate(a.expiryMonth.value,a.expiryYear.value)){if(0==a.cardCVV.value.trim().length)return dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML=applyODRStoreText.BPSPaymentMethods_CLUB_CVV_NOT_EMPTY,void addErrorRecord("3",a.cardCVV.id,applyODRStoreText.BPSPaymentMethods_CLUB_CVV_NOT_EMPTY);if(null!=a.cardCVV.value&&!new RegExp("[*]{3,4}|[0-9]{3,4}").test(a.cardCVV.value)&&4!=a.cardCVV.value.length)return dojo.byId("BPS_OPC_Club_Rewards_LookUp_Error").innerHTML=applyODRStoreText.BPSEDPPaymentMethods_CVV_NOT_VALID,void addErrorRecord("3",a.cardCVV.id,applyODRStoreText.BPSEDPPaymentMethods_CVV_NOT_VALID);null!=d&&d.length>0&&(d.startsWith("559136")||d.startsWith("552341")||d.startsWith("555422"))&&dojo.byId("BPS_OPC_SAVE_CLUB_CARD")&&(dojo.byId("BPS_OPC_SAVE_CLUB_CARD").checked=!1);var o=BPSClubRewardsJS.getCommonParameters();if(o.requesttype="ajax",o.responseFormat="json",dojo.byId("BPS_OPC_SAVE_CLUB_CARD")&&!0===dojo.byId("BPS_OPC_SAVE_CLUB_CARD").checked){if(o.cardNumber=d,o.expiryDate=a.expiryMonth.value+a.expiryYear.value,o.firstName=dojo.byId("billing_address_mutlipay_firstName").value,o.lastName=dojo.byId("billing_address_mutlipay_lastName").value,o.cvv=a.cardCVV.value,o.options=0,o.saveClubCard="true",o.isTempClubCard="false",o.isAuthReqd="true",!submitRequest())return;cursor_wait(),window.bpsAnalyticsErrorFieldId=e.id,wc.service.invoke("AjaxAddClubRewardsCardItem",o)}else{o.account=d,o.cc_cvc=a.cardCVV.value,o.authToken=dojo.byId("BPS_ApplyClubRewardsODR_authToken").value,o.payMethodId="ClubCredit",o.piAmount=0,o.cc_brand=t;var l=document.querySelectorAll("input[data-address-id]");if(l[1]?o.billing_address_id=l[1].value:o.billing_address_id=dojo.byId("billing_address_id_1").value,o.expire_month=a.expiryMonth.value,o.expire_year=a.expiryYear.value,o.saveClubCard="false",o.isTempClubCard="true",o.isClubPointsApplied="false",!submitRequest())return;cursor_wait(),window.bpsAnalyticsErrorFieldId=e.id,wc.service.invoke("AjaxAddClubRewardsCardItemToThisOrder",o)}}else addErrorRecord("3",a.expiryMonth.id+"|"+a.expiryYear.id,"")},addClubCard:function(){"none"==dojo.byId("bps_club_rewards_lookup_input").style.display?dojo.byId("bps_club_rewards_lookup_input").style.display="block":dojo.byId("bps_club_rewards_lookup_input").style.display="none",byId("opcAddClubCardFormButton")&&byId("opcAddClubCardFormButton").classList.add("btn-disabled")}};