dojo.require("wc.service.common"),wc.service.declare({id:"BPSAjaxAddGCToThisOrder",actionId:"BPSAjaxAddGCToThisOrder",url:"AjaxRESTOrderPIAdd",formId:"",successHandler:function(e){MessageHelper.removeBPSAlertErrorId(),cursor_clear(),analyticsLayersJS.addLastAction("ApplyPayment",!0,{tm_Pymt_Typ_Cd:"GC"})},failureHandler:function(e){var r=document.getElementById("BPS_ApplyGiftCard_Error");MessageHelper.removeBPSAlertErrorId(),e.errorMessage?bpAlerts.createAlert("","BPS_ApplyGiftCard_Error","after","error","",e.errorMessage):e.errorMessageKey&&bpAlerts.createAlert("","BPS_ApplyGiftCard_Error","after","error","",e.errorMessageKey),r.style.display="block",cursor_clear(),analyticsLayersJS.addLastAction("ApplyFailPayment",!0,{tm_Pymt_Typ_Cd:"GC"})}}),wc.service.declare({id:"BPSAjaxDeleteGCPaymentInstructionFromThisOrder",actionId:"BPSAjaxDeleteGCPaymentInstructionFromThisOrder",url:"AjaxRESTOrderPIDelete",formId:"",successHandler:function(e){MessageHelper.removeBPSAlertErrorId(),cursor_clear(),analyticsLayersJS.addLastAction("RemovePayment",!0,{tm_Pymt_Typ_Cd:"GC"})},failureHandler:function(e){MessageHelper.removeBPSAlertErrorId(),e.errorMessage?bpAlerts.createAlert("","BPS_ApplyGiftCard_Error","after","error","",e.errorMessage):e.errorMessageKey&&bpAlerts.createAlert("","BPS_ApplyGiftCard_Error","after","error","",e.errorMessage),cursor_clear()}}),wc.service.declare({id:"AjaxGetOutdoorRewardsPoints",actionId:"AjaxGetOutdoorRewardsPoints",url:"AjaxRESTGetOutdoorRewards",formId:"",successHandler:function(e){cursor_clear(),analyticsLayersJS.addLastAction("ApplyPayment",!0,{tm_Pymt_Typ_Cd:"OR"})},failureHandler:function(e){var r=document.getElementById("BPS_OPC_Rewards_LookUp_Error");e.errorMessage?r.innerHTML=e.errorMessage:e.errorMessageKey&&(r.innerHTML=e.errorMessageKey),r.style.display="block",cursor_clear(),analyticsLayersJS.addLastAction("ApplyFailPayment",!0,{tm_Pymt_Typ_Cd:"OR"})}}),wc.service.declare({id:"AjaxAddClubRewardsCardItem",actionId:"AjaxAddClubRewardsCardItem",url:getAbsoluteURL()+"AjaxRESTAddWalletItem",formId:"",successHandler:function(e){setCookie("WC_Total_Points",null,{path:"/",expires:-1,domain:""}),cursor_clear(),analyticsLayersJS.addLastAction("ApplyPayment",!0,{tm_Pymt_Typ_Cd:"ClubCC"})},failureHandler:function(e){var r=document.getElementById("BPS_OPC_Club_Rewards_LookUp_Error");"error.credit.card.validation.failure"==e.errorMessageKey?(r.innerHTML="We are currently unable to add your CLUB Card.  Please try again later.",addErrorRecord("3",window.bpsAnalyticsErrorFieldId,"We are currently unable to add your CLUB Card.  Please try again later.")):e.errorMessage?(r.innerHTML=e.errorMessage,addErrorRecord("3",window.bpsAnalyticsErrorFieldId,e.errorMessage)):e.errorMessageKey&&(r.innerHTML=e.errorMessageKey,addErrorRecord("3",window.bpsAnalyticsErrorFieldId,e.errorMessageKey)),r.style.display="block",cursor_clear(),analyticsLayersJS.addLastAction("ApplyFailPayment",!0,{tm_Pymt_Typ_Cd:"ClubCC"})}}),wc.service.declare({id:"AjaxClubExclusiveValidateFraudCCUsage",actionId:"AjaxClubExclusiveValidateFraudCCUsage",url:getAbsoluteURL()+"AjaxRESTValidateFraudCCUsage",formId:"",successHandler:function(e){cursor_clear();var r="";if(null!=document.getElementById("AddClubExclusiveCardForm").elements.clubexrecaptchakey&&(r=document.getElementById("AddClubExclusiveCardForm").elements.clubexrecaptchakey.value),e.invokeReCaptcha)console.log("Invoking clubexclusive recaptcha... "),grecaptcha.execute();else{console.log("Clubexclusive Recaptcha not invoked as switch is off or the attempt is under the limit"),BPSClubRewardsJS.addClubExclusiveCard(document.getElementById("AddClubExclusiveCardForm"),r)}}}),wc.service.declare({id:"AjaxClubExclusiveVerifyCaptchaResponse",actionId:"AjaxClubExclusiveVerifyCaptchaResponse",url:getAbsoluteURL()+"AjaxRESTVerifyCaptchaResponse",formId:"",successHandler:function(e){if(e.isCaptchaRespSuccess){console.log("CubExclusive Recaptcha verified... ");var r="";null!=document.getElementById("AddClubExclusiveCardForm").elements.clubexrecaptchakey&&(r=document.getElementById("AddClubExclusiveCardForm").elements.clubexrecaptchakey.value),BPSClubRewardsJS.addClubExclusiveCard(document.getElementById("AddClubExclusiveCardForm"),r)}else{var a=document.getElementById("BPS_OPC_Club_Rewards_LookUp_Error");MessageHelper.removeBPSAlertErrorId(),bpAlerts.createAlert("","BPS_OPC_Club_Rewards_LookUp_Error","after","error","","Your recaptcha was not verified, please try to save your card again.",!0),a.style.display="block",cursor_clear()}},failureHandler:function(e){e.errorMessage?MessageHelper.displayErrorMessage(e.errorMessage):e.errorMessageKey&&MessageHelper.displayErrorMessage(e.errorMessageKey),cursor_clear()}}),wc.service.declare({id:"AjaxAddClubExclusiveCardItem",actionId:"AjaxAddClubExclusiveCardItem",url:getAbsoluteURL()+"AjaxRESTAddWalletItem",formId:"",successHandler:function(e){cursor_clear(),dojo.byId("clubExclusiveStep2")&&void 0!=dojo.byId("clubExclusiveStep2")&&"none"!=dojo.byId("clubExclusiveStep2").style.display&&(dojo.byId("clubExclusiveStep2").style.display="none",dojo.byId("clubExclusiveStep1").style.display="none",dojo.byId("clubExclusiveStep3").style.display="block",dojo.byId("savedCards").value=!0,void 0!==analyticsDataLayer.customer&&(analyticsDataLayer.customer.tm_ClubAccount_Status="true"),dojo.byId("grayOut").style.display="block",dojo.byId("grayOut").setAttribute("onclick","cursor_clear();dijit.byId('clubExclusivePopup').hide(); byId('grayOut').removeAttribute('onclick');"))},failureHandler:function(e){var r=document.getElementById("BPS_OPC_Club_Rewards_LookUp_Error");"error.credit.card.validation.failure"==e.errorMessageKey?(MessageHelper.removeBPSAlertErrorId(),bpAlerts.createAlert("","BPS_OPC_Club_Rewards_LookUp_Error","after","error","","We are currently unable to add your CLUB Card.  Please try again later.",!0),r.style.display="block",addErrorRecord("3",window.bpsAnalyticsErrorFieldId,"We are currently unable to add your CLUB Card.  Please try again later.")):e.errorMessage?(MessageHelper.removeBPSAlertErrorId(),bpAlerts.createAlert("","BPS_OPC_Club_Rewards_LookUp_Error","after","error","","We are currently unable to add your CLUB Card.  Please try again later.",!0),r.style.display="block",addErrorRecord("3",window.bpsAnalyticsErrorFieldId,e.errorMessage)):e.errorMessageKey&&(MessageHelper.removeBPSAlertErrorId(),bpAlerts.createAlert("","BPS_OPC_Club_Rewards_LookUp_Error","after","error","",e.errorMessageKey,!0),r.style.display="block",addErrorRecord("3",window.bpsAnalyticsErrorFieldId,e.errorMessageKey)),dojo.byId("savedCards")&&"none"!=dojo.byId("clubExclusiveStep2").style.display&&(dojo.byId("savedCards").value=!1,void 0!==analyticsDataLayer.customer&&(analyticsDataLayer.customer.tm_ClubAccount_Status="")),cursor_clear(),dojo.byId("grayOut")&&(dojo.byId("grayOut").style.display="block")}}),wc.service.declare({id:"AjaxAddClubRewardsCardItemToThisOrder",actionId:"AjaxAddClubRewardsCardItemToThisOrder",url:getAbsoluteURL()+"AjaxRESTOrderPIAdd",formId:"",successHandler:function(e){cursor_clear(),analyticsLayersJS.addLastAction("ApplyPayment",!0,{tm_Pymt_Typ_Cd:"ClubCC"})},failureHandler:function(e){var r=document.getElementById("BPS_OPC_Club_Rewards_LookUp_Error");"error.credit.card.validation.failure"==e.errorMessageKey?(r.innerHTML="We are currently unable to add your CLUB Card.  Please try again later.",addErrorRecord("3",window.bpsAnalyticsErrorFieldId,"We are currently unable to add your CLUB Card.  Please try again later.")):e.errorMessage?(r.innerHTML=e.errorMessage,addErrorRecord("3",window.bpsAnalyticsErrorFieldId,e.errorMessage)):e.errorMessageKey&&(r.innerHTML=e.errorMessageKey,addErrorRecord("3",window.bpsAnalyticsErrorFieldId,e.errorMessageKey)),r.style.display="block",cursor_clear(),analyticsLayersJS.addLastAction("ApplyFailPayment",!0,{tm_Pymt_Typ_Cd:"ClubCC"})}}),wc.service.declare({id:"AjaxUpdateClubRewardsCardItemToThisOrder",actionId:"AjaxUpdateClubRewardsCardItemToThisOrder",url:getAbsoluteURL()+"AjaxRESTOrderPIUpdate",formId:"",successHandler:function(e){cursor_clear();var r="FALSE";dojo.byId("isCLUBPointsPromoActive")&&(r=dojo.byId("isCLUBPointsPromoActive").value),1==CheckoutPayments.numberOfPaymentMethods&&r&&setTimeout(function(){var r=[];r.storeId=CheckoutHelperJS.storeId,r.catalogId=CheckoutHelperJS.catalogId,r.langId=CheckoutHelperJS.langId,r.orderItemId=[];for(var a=dojo.byId("totalNumberOfItems").value,o=1;o<=a;o++){var s=dojo.byId("orderItem_"+o).value,d="freeGiftItem_"+s;dojo.byId(d)||r.orderItemId.push(s)}r.orderId=e.orderId,r.calculationUsage="-1,-2,-3,-4,-5,-6,-7,-10",r.calculateOrder="1",wc.service.invoke("AjaxUpdateOrderItem",r)},50),analyticsLayersJS.addLastAction("ApplyPoints",!0,{tm_Pymt_Typ_Cd:"Club"})},failureHandler:function(e){var r=document.getElementById("BPS_OPC_Club_Rewards_LookUp_Error");e.errorMessage?r.innerHTML=e.errorMessage:e.errorMessageKey&&(r.innerHTML=e.errorMessageKey),r.style.display="block",cursor_clear(),analyticsLayersJS.addLastAction("ApplyFailPayment",!0,{tm_Pymt_Typ_Cd:"ClubCC"})}}),wc.service.declare({id:"AjaxRemoveClubRewardsPointsFromThisOrder",actionId:"AjaxRemoveClubRewardsPointsFromThisOrder",url:getAbsoluteURL()+"AjaxRESTOrderPIUpdate",formId:"",successHandler:function(e){cursor_clear(),analyticsLayersJS.addLastAction("RemovePoints",!0,{tm_Pymt_Typ_Cd:"Club"})},failureHandler:function(e){var r=document.getElementById("BPS_OPC_Club_Rewards_LookUp_Error");e.errorMessage?r.innerHTML=e.errorMessage:e.errorMessageKey&&(r.innerHTML=e.errorMessageKey),r.style.display="block",cursor_clear()}}),wc.service.declare({id:"BPSAjaxDeleteRewardsPIFromThisOrder",actionId:"BPSAjaxDeleteRewardsPIFromThisOrder",url:"AjaxRESTOrderPIDelete",formId:"",successHandler:function(e){cursor_clear(),analyticsLayersJS.addLastAction("RemovePoints",!0,{tm_Pymt_Typ_Cd:"OutdoorRewards"})},failureHandler:function(e){e.errorMessage?MessageHelper.displayErrorMessage(e.errorMessage):e.errorMessageKey&&MessageHelper.displayErrorMessage(e.errorMessageKey),cursor_clear()}}),wc.service.declare({id:"BPSAjaxRedeemRewardsToThisOrder",actionId:"BPSAjaxRedeemRewardsToThisOrder",url:"AjaxRESTOrderPIAdd",formId:"",successHandler:function(e){dojo.byId("BPS_Apply_Outdoor_Rewards_Expanded").style="display:none",cursor_clear();var r="FALSE";dojo.byId("isODRPromoActive")&&(r=dojo.byId("isODRPromoActive").value);var a=e.piAmount[0],o=parseFloat(document.getElementById("BPS_piAmount_remaining").value)==a,s=parseFloat(document.getElementById("grandTotalAnalytics").value)==a;supportPaymentTypePromotions&&"TRUE"==r&&o&&s&&(resetRequest(),dojo.byId("dontaddUnboundforODR")&&(dojo.byId("dontaddUnboundforODR").value="TRUE"),CheckoutPayments.updateUnboundPaymentToOrder(!0)),1==CheckoutPayments.numberOfPaymentMethods&&r&&setTimeout(function(){var r=[];r.storeId=CheckoutHelperJS.storeId,r.catalogId=CheckoutHelperJS.catalogId,r.langId=CheckoutHelperJS.langId,r.orderItemId=[];for(var a=dojo.byId("totalNumberOfItems").value,o=1;o<=a;o++){var s=dojo.byId("orderItem_"+o).value,d="freeGiftItem_"+s;dojo.byId(d)||r.orderItemId.push(s)}r.orderId=e.orderId,r.calculationUsage="-1,-2,-3,-4,-5,-6,-7,-10",r.calculateOrder="1",wc.service.invoke("AjaxUpdateOrderItem",r)},100),analyticsLayersJS.addLastAction("ApplyPoints",!0,{tm_Pymt_Typ_Cd:"OutdoorRewards"})},failureHandler:function(e){var r=document.getElementById("BPS_OPC_Rewards_Redeem_Error");e.errorMessage?r.innerHTML=e.errorMessage:e.errorMessageKey&&(r.innerHTML=e.errorMessageKey),r.style.display="block",cursor_clear(),analyticsLayersJS.addLastAction("ApplyFailPoints",!0,{tm_Pymt_Typ_Cd:"OutdoorRewards"})}}),wc.service.declare({id:"BPSAjaxDeleteCCPIFromThisOrder",actionId:"BPSAjaxDeleteCCPIFromThisOrder",url:"AjaxRESTOrderPIDelete",formId:"",successHandler:function(e){if(cursor_clear(),void 0!==document.getElementById("PaymentForm1").payMethodId)var r=document.getElementById("PaymentForm1").payMethodId.value.toLowerCase().indexOf("club")>-1?"ClubCC":"CC";analyticsLayersJS.addLastAction("RemovePayment",!0,{tm_Pymt_Typ_Cd:void 0!==r?r:"NA"})},failureHandler:function(e){e.errorMessage?MessageHelper.displayErrorMessage(e.errorMessage):e.errorMessageKey&&MessageHelper.displayErrorMessage(e.errorMessageKey),cursor_clear()}}),wc.service.declare({id:"AjaxUpdateOrderItemBPSOPC",actionId:"AjaxUpdateOrderItemBPSOPC",url:getAbsoluteURL()+"AjaxRESTOrderItemUpdate",formId:"",successHandler:function(e){MessageHelper.hideAndClearMessage(),MessageHelper.hideFormErrorHandle(),"undefined"!=e.attributeName_ord_1||"undefined"!=e.attributeName_ord_2?dojo.publish("goAheadShipToStore"):(cursor_clear(),dojo.byId("shipToStoreContinueButton")&&(dojo.byId("shipToStoreContinueButton").removeAttribute("disabled"),dojo.addClass("shipToStoreContinueButton","shipToStoreContinueButtonEnable"),dojo.removeClass("shipToStoreContinueButton","shipToStoreContinueButtonDisable")))},failureHandler:function(e){e.errorMessage?"_ERR_RETRIEVE_PRICE"==e.errorMessageKey?MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_RETRIEVE_PRICE_QTY_UPDATE):MessageHelper.displayErrorMessage(e.errorMessage):e.errorMessageKey&&MessageHelper.displayErrorMessage(e.errorMessageKey),e.errorCode&&dojo.publish("OrderError",e),cursor_clear(),dojo.byId("shipToStoreContinueButton")&&(dojo.byId("shipToStoreContinueButton").removeAttribute("disabled"),dojo.addClass("shipToStoreContinueButton","shipToStoreContinueButtonEnable"),dojo.removeClass("shipToStoreContinueButton","shipToStoreContinueButtonDisable"))}}),wc.service.declare({id:"BPSAjaxRemoveWalletItem",actionId:"BPSAjaxRemoveWalletItem",url:getAbsoluteURL()+"AjaxRESTDeleteWalletItem",formId:"",successHandler:function(e){cursor_clear(),analyticsLayersJS.addLastAction("RemovePayment",!0,{tm_Pymt_Typ_Cd:"CC"})},failureHandler:function(e){e.errorMessage?MessageHelper.displayErrorMessage(e.errorMessage):e.errorMessageKey&&MessageHelper.displayErrorMessage(e.errorMessageKey),cursor_clear()}}),wc.service.declare({id:"BPSAjaxSetAddressIdOfOrderItems",actionId:"BPSAjaxSetAddressIdOfOrderItems",url:"AjaxRESTOrderShipInfoUpdate",formId:"",successHandler:function(e){var r="false";if(dojo.byId("BPS_OPC_EGIFT_CARD_ONLY")||(MessageHelper.bpsDisplayItemShipRestriction(e),(e.orderError||e.itemError)&&(r="true",window.localStorage.setItem("shippingRestrictionError",JSON.stringify(e)))),cursor_clear(),dojo.byId("BPS_OPC_EGIFT_CARD_ONLY")||dojo.byId("selectedAddressIdUpdated")&&"true"==dojo.byId("selectedAddressIdUpdated").value||"true"==e.reviewDone)dojo.byId("shipToStoreContinueButton")&&(dojo.byId("shipToStoreContinueButton").removeAttribute("disabled"),dojo.addClass("shipToStoreContinueButton","shipToStoreContinueButtonEnable"),dojo.removeClass("shipToStoreContinueButton","shipToStoreContinueButtonDisable"));else if(dojo.byId("selAddrIdUpdSTSDropShip")&&"true"==dojo.byId("selAddrIdUpdSTSDropShip").value)BPSCheckoutHelperJS.whereToShip("shipToYouWithReload");else{var a;if(a=e.storeId.length>1?e.storeId[0]:e.storeId,dojo.byId("selectedAddressIdUpdated")&&"false"==dojo.byId("selectedAddressIdUpdated").value&&"undefined"!=storeUserType&&null!=storeUserType&&"G"==storeUserType.toUpperCase()){window.localStorage.setItem("guestCreateAddress","true");var o="OrderShippingBillingView?orderId="+(e.orderId?e.orderId:".")+"&guestContinue=true&langId="+e.langId+"&storeId="+a+"&catalogId="+e.catalogId+"&showRegTag=T&shippingRestrictionError="+r}else o="OrderShippingBillingView?orderId="+(e.orderId?e.orderId:".")+"&langId="+e.langId+"&storeId="+a+"&catalogId="+e.catalogId+"&showRegTag=T&shippingRestrictionError="+r;document.location.href=appendWcCommonRequestParameters(o)}},failureHandler:function(e){e.errorMessage?MessageHelper.displayErrorMessage(e.errorMessage):e.errorMessageKey&&MessageHelper.displayErrorMessage(e.errorMessageKey),document.getElementById("OrderShippingBillingErrorArea").style.display="block",cursor_clear(),dojo.byId("shipToStoreContinueButton")&&(dojo.byId("shipToStoreContinueButton").removeAttribute("disabled"),dojo.addClass("shipToStoreContinueButton","shipToStoreContinueButtonEnable"),dojo.removeClass("shipToStoreContinueButton","shipToStoreContinueButtonDisable"))}}),wc.service.declare({id:"AjaxRedeemClubRewards",actionId:"AjaxRedeemClubRewards",url:"AjaxRESTOrderPIAdd",formId:"",successHandler:function(e){cursor_clear();var r="FALSE";dojo.byId("isCLUBPointsPromoActive")&&(r=dojo.byId("isCLUBPointsPromoActive").value);var a=e.piAmount[0],o=parseFloat(document.getElementById("BPS_piAmount_remaining").value)==a,s=parseFloat(document.getElementById("grandTotalAnalytics").value)==a;supportPaymentTypePromotions&&"TRUE"==r&&o&&s&&(resetRequest(),dojo.byId("dontaddUnboundforClubPoints")&&(dojo.byId("dontaddUnboundforClubPoints").value="TRUE"),CheckoutPayments.updateUnboundPaymentToOrder(!0)),dojo.byId("isCLUBPointsPromoActive")&&(r=dojo.byId("isCLUBPointsPromoActive").value),1==CheckoutPayments.numberOfPaymentMethods&&r&&setTimeout(function(){var r=[];r.storeId=CheckoutHelperJS.storeId,r.catalogId=CheckoutHelperJS.catalogId,r.langId=CheckoutHelperJS.langId,r.orderItemId=[];for(var a=dojo.byId("totalNumberOfItems").value,o=1;o<=a;o++){var s=dojo.byId("orderItem_"+o).value,d="freeGiftItem_"+s;dojo.byId(d)||r.orderItemId.push(s)}r.orderId=e.orderId,r.calculationUsage="-1,-2,-3,-4,-5,-6,-7,-10",r.calculateOrder="1",wc.service.invoke("AjaxUpdateOrderItem",r)},100),analyticsLayersJS.addLastAction("ApplyPoints",!0,{tm_Pymt_Typ_Cd:"Club"})},failureHandler:function(e){e.errorMessage?(MessageHelper.displayErrorMessage(e.errorMessage),addErrorRecord("3",window.bpsAnalyticsErrorFieldId,String(e.errorMessage))):e.errorMessageKey&&MessageHelper.displayErrorMessage(e.errorMessageKey),cursor_clear(),analyticsLayersJS.addLastAction("ApplyFailPoints",!0,{tm_Pymt_Typ_Cd:"Club"})}}),wc.service.declare({id:"AjaxRemoveClubRewards",actionId:"AjaxRemoveClubRewards",url:"AjaxRESTOrderPIDelete",formId:"",successHandler:function(e){cursor_clear(),analyticsLayersJS.addLastAction("RemovePoints",!0,{tm_Pymt_Typ_Cd:"Club"})},failureHandler:function(e){e.errorMessage?MessageHelper.displayErrorMessage(e.errorMessage):e.errorMessageKey&&MessageHelper.displayErrorMessage(e.errorMessageKey),cursor_clear()}}),wc.service.declare({id:"BPSAjaxUpdateWalletItem",actionId:"BPSAjaxUpdateWalletItem",url:getAbsoluteURL()+"AjaxRESTUpdateWalletItem",formId:"",successHandler:function(e){cursor_clear(),analyticsLayersJS.addLastAction("ApplyPayment",!0,{tm_Pymt_Typ_Cd:"CC"})},failureHandler:function(e){e.errorMessage?MessageHelper.displayErrorMessage(e.errorMessage):e.errorMessageKey&&MessageHelper.displayErrorMessage(e.errorMessageKey),cursor_clear(),analyticsLayersJS.addLastAction("ApplyFailPayment",!0,{tm_Pymt_Typ_Cd:"CC"})}});